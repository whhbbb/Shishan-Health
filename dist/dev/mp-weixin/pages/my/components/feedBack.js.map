{"version":3,"file":"feedBack.js","sources":["../../../../../../src/pages/my/components/feedBack.vue","../../../../../../uniPage:/cGFnZXMvbXkvY29tcG9uZW50cy9mZWVkQmFjay52dWU"],"sourcesContent":["<template>\r\n  <view v-if=\"isPastTargetDate\" class=\"feedback\">\r\n    <view class=\"feedback-item\">\r\n      <view class=\"feedback-content\">\r\n        <view class=\"feedback-content-item\">\r\n          <view class=\"feedback-content-item-title\">问题描述</view>\r\n          <view class=\"feedback-content-item-input\">\r\n            <textarea\r\n              name=\"\"\r\n              id=\"\"\r\n              cols=\"30\"\r\n              rows=\"10\"\r\n              placeholder=\"请描述您的问题\"\r\n              v-model=\"feedBack.problem\"\r\n            ></textarea>\r\n          </view>\r\n        </view>\r\n        <view class=\"feedback-content-item\">\r\n          <view class=\"feedback-content-item-title\">上传图片</view>\r\n          <uni-file-picker\r\n            limit=\"9\"\r\n            mode=\"grid\"\r\n            file-mediatype=\"image\"\r\n            @select=\"select\"\r\n            @delete=\"deleteImg\"\r\n          />\r\n        </view>\r\n        <view class=\"feedback-content-item\">\r\n          <view class=\"feedback-content-item-title\">联系人姓名</view>\r\n          <view class=\"feedback-content-item-input\">\r\n            <uni-easyinput\r\n              v-model=\"feedBack.name\"\r\n              type=\"text\"\r\n              placeholder=\"请输入您的名字\"\r\n              @confirm=\"\"\r\n              next\r\n            />\r\n          </view>\r\n        </view>\r\n        <view class=\"feedback-content-item\">\r\n          <view class=\"feedback-content-item-title\">联系方式</view>\r\n          <view class=\"feedback-content-item-input\">\r\n            <uni-easyinput\r\n              v-model=\"feedBack.contact\"\r\n              type=\"text\"\r\n              placeholder=\"请输入您的联系方式\"\r\n              @confirm=\"\"\r\n              done\r\n            />\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <view class=\"feedback-btn\">\r\n        <button class=\"btn\" type=\"primary\" size=\"default\" @tap=\"submit\">提交</button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { postFeedbackAPI } from '@/services/feedBack'\r\nimport { ref, reactive, computed } from 'vue'\r\nimport { onLoad, onShow } from '@dcloudio/uni-app'\r\n//过审\r\n// 获取当前时间点\r\nconst currentTime = ref(new Date())\r\n\r\n// 计算2023年11月17号的时间点\r\nconst targetDate = new Date('2023-11-23')\r\n\r\n// 判断当前时间是否已经过了2023年11月17号\r\nimport { getAudit } from '@/services/Audit'\r\nconst isPastTargetDate = ref<boolean>(false)\r\nconst getA = async () => {\r\n  const res = await getAudit()\r\n  console.log(res)\r\n  isPastTargetDate.value = res.data\r\n  console.log(isPastTargetDate.value)\r\n  // if (!isPastTargetDate.value) {\r\n  //   uni.showToast({\r\n  //     title: '意见反馈部分功能尚未实现，敬请期待~',\r\n  //     icon: 'none',\r\n  //     duration: 1000\r\n  //   })\r\n  // }\r\n  if (!uni.getStorageSync('token')) {\r\n    uni.showToast({\r\n      title: '您未登录！',\r\n      icon: 'none',\r\n      duration: 1000,\r\n    })\r\n  }\r\n}\r\nonLoad(() => {\r\n  getA()\r\n})\r\nonShow(() => {\r\n  // getA()\r\n  // console.log(isPastTargetDate.value)\r\n})\r\ntype img = {\r\n  now: string\r\n  temp: string\r\n}\r\ntype postContent = {\r\n  content: string\r\n  phone: string\r\n  picture: string\r\n  name: string\r\n  id: string\r\n}\r\ntype feedBackContent = {\r\n  problem: string\r\n  contact: string\r\n  img: Array<img>\r\n  name: string\r\n}\r\n\r\nconst feedBack = ref<feedBackContent>({\r\n  problem: '',\r\n  contact: '',\r\n  img: [],\r\n  name: '',\r\n})\r\n\r\nconst validatePhone = (phone: string) => {\r\n  const reg = /^1\\d{10}$/\r\n  return reg.test(phone)\r\n}\r\n\r\nconst deleteImg = (e: any) => {\r\n  const index = e.index\r\n  console.log(e)\r\n  feedBack.value.img.forEach((item, index) => {\r\n    if (item.temp === e.tempFilePath) {\r\n      feedBack.value.img.splice(index, 1)\r\n    }\r\n  })\r\n}\r\nconst select = (e: any) => {\r\n  console.log(e)\r\n  const tempFilePaths = e.tempFilePaths\r\n  uploadFiles(tempFilePaths, 0)\r\n}\r\n\r\nconst uploadFiles = async (tempFilePaths: any, i: any) => {\r\n  const res = await uni.uploadFile({\r\n    url: 'https://www.academictime.cn:3166/system/common/upload',\r\n    filePath: tempFilePaths[i],\r\n    header: {\r\n      Authorization: 'Bearer ' + uni.getStorageSync('token'),\r\n      'Content-Type': 'multipart/form-data',\r\n    },\r\n    name: 'file',\r\n    success: (res) => {\r\n      console.log(res)\r\n      const resData = JSON.parse(res.data)\r\n      feedBack.value.img.push({ now: resData.msg, temp: tempFilePaths[i] })\r\n    },\r\n    fail: () => {\r\n      console.log('fail')\r\n      uni.showToast({\r\n        title: '上传失败',\r\n        icon: 'none',\r\n      })\r\n    },\r\n  })\r\n}\r\n\r\nconst postFeedback = async (data: postContent) => {\r\n  const res = await postFeedbackAPI(data)\r\n  console.log(res)\r\n  if (res.code == 200) {\r\n    wx.showToast({\r\n      title: res.msg,\r\n      icon: 'success',\r\n      duration: 2000,\r\n      complete: function () {\r\n        setTimeout(function () {\r\n          uni.switchTab({\r\n            url: '/pages/my/my',\r\n          })\r\n        }, 2000)\r\n      },\r\n    })\r\n  } else if (res.code == 401) {\r\n    uni.showToast({\r\n      title: '您未登录！',\r\n      icon: 'none',\r\n      duration: 1000,\r\n    })\r\n  } else {\r\n    wx.showToast({\r\n      title: res.msg,\r\n      icon: 'none',\r\n      duration: 2000,\r\n    })\r\n  }\r\n}\r\n\r\nconst submit = () => {\r\n  console.log(feedBack.value)\r\n  let imgString = feedBack.value.img.map((item) => item.now).join('&')\r\n  console.log(imgString)\r\n  if (feedBack.value.problem === '') {\r\n    uni.showToast({\r\n      title: '请填写问题描述',\r\n      icon: 'none',\r\n    })\r\n    return\r\n  } else if (feedBack.value.name === '') {\r\n    uni.showToast({\r\n      title: '请填写联系人姓名',\r\n      icon: 'none',\r\n    })\r\n  } else if (feedBack.value.contact === '') {\r\n    uni.showToast({\r\n      title: '请填写联系方式',\r\n      icon: 'none',\r\n    })\r\n  } else if (!validatePhone(feedBack.value.contact)) {\r\n    uni.showToast({\r\n      title: '请填写正确的联系方式',\r\n      icon: 'none',\r\n    })\r\n  } else {\r\n    postFeedback({\r\n      name: feedBack.value.name,\r\n      phone: feedBack.value.contact,\r\n      content: feedBack.value.problem,\r\n      picture: imgString,\r\n      id: '',\r\n    })\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n.feedback {\r\n  // height: 100vh;\r\n  overflow-y: scroll;\r\n  width: 90%;\r\n  margin: 0 auto;\r\n\r\n  .feedback-item {\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #fff;\r\n    padding: 20rpx;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n\r\n    .feedback-content {\r\n      width: 100%;\r\n      height: 95%;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-around;\r\n\r\n      .feedback-content-item {\r\n        margin-top: 5%;\r\n        width: 100%;\r\n        flex: 1;\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: center;\r\n        // margin-bottom: 60rpx;\r\n\r\n        .feedback-content-item-title {\r\n          font-size: 28rpx;\r\n          font-weight: 600;\r\n          color: #5d5c5c;\r\n          margin-bottom: 20rpx;\r\n        }\r\n\r\n        .feedback-content-item-input {\r\n          width: 100%;\r\n          height: 100%;\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: space-between;\r\n\r\n          textarea {\r\n            width: 100%;\r\n            height: 200rpx;\r\n            border: 1px solid #eee;\r\n            border-radius: 10rpx;\r\n            padding: 20rpx;\r\n            box-sizing: border-box;\r\n            font-size: 28rpx;\r\n            color: #5d5c5c;\r\n            resize: none;\r\n          }\r\n\r\n          .feedback-content-item-input-img {\r\n            width: 100%;\r\n            height: 200rpx;\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n\r\n            image {\r\n              width: 200rpx;\r\n              height: 200rpx;\r\n              border: 1px solid #eee;\r\n              border-radius: 10rpx;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .feedback-btn {\r\n      flex: 1;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: flex-end;\r\n      margin-bottom: 30rpx;\r\n\r\n      .btn {\r\n        margin-top: 70rpx;\r\n        width: 40%;\r\n        font-size: 35rpx;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/feidian/计算机设计大赛/xswc_cs/src/pages/my/components/feedBack.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getAudit","uni","onLoad","onShow","index","res","postFeedbackAPI","wx"],"mappings":"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"}