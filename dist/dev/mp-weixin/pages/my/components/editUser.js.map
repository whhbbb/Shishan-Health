{"version":3,"file":"editUser.js","sources":["../../../../../../src/pages/my/components/editUser.vue","../../../../../../uniPage:/cGFnZXMvbXkvY29tcG9uZW50cy9lZGl0VXNlci52dWU"],"sourcesContent":["<template>\n  <view v-if=\"isPastTargetDate\" class=\"user\">\n    <navigator class=\"avatar item\" :url=\"`/pages/my/components/userImage?userAvatar=${user.img}`\">\n      <view>头像</view>\n      <view class=\"user-avatar texts\">\n        <image class=\"img\" :src=\"user.img\" />\n        <image src=\"../../../static/my/arrow-right.png\" />\n      </view>\n    </navigator>\n    <view class=\"item\">\n      <view>名字</view>\n      <view class=\"texts\">\n        <text class=\"text1\">{{ user.name }}</text>\n      </view>\n    </view>\n    <view class=\"item\">\n      <view>学院</view>\n      <view class=\"texts\">\n        <text class=\"text1\">{{ user.college }}</text>\n      </view>\n    </view>\n    <view class=\"item\">\n      <view>学号</view>\n      <view class=\"texts\">\n        <text class=\"text1\">{{ user.studentId }}</text>\n      </view>\n    </view>\n    <view class=\"item\">\n      <view>用户名</view>\n      <view class=\"texts\">\n        <text class=\"text1\" v-if=\"!isDisabled\">{{ user.nickName }}</text>\n        <uni-easyinput class=\"text2\" v-else v-model=\"editedUser.nickName\" />\n      </view>\n    </view>\n    <view class=\"item\">\n      <view>电话</view>\n      <view class=\"texts\">\n        <text class=\"text1\" v-if=\"!isDisabled\">{{ user.phonenumber }}</text>\n\n        <uni-easyinput v-else class=\"text2\" v-model=\"editedUser.phonenumber\" />\n      </view>\n    </view>\n    <view class=\"btns\">\n      <button @tap=\"changeUserInfo\" v-if=\"!isDisabled\">修改个人资料</button>\n      <view v-if=\"isDisabled\">\n        <button @tap=\"saveEdit\">保存</button>\n        <button @tap=\"cancelEdit\">取消修改</button>\n      </view>\n      <button @click=\"editPassword\">修改密码</button>\n      <button @tap=\"logout\">退出登录</button>\n    </view>\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive } from 'vue'\nimport { onLoad, onShow } from '@dcloudio/uni-app'\nimport { getPersonalInf, changePersonalInf } from '@/services/personalInf'\n// type userInfo = {\n//   name: string\n//   studentId: string\n//   img?: string\n//   // 学院\n//   college: string\n// }\nimport { getAudit } from '@/services/Audit'\nconst isPastTargetDate = ref<boolean>(false)\nconst getA = async () => {\n  const res = await getAudit()\n  console.log(res)\n  isPastTargetDate.value = res.data\n}\nconst isDisabled = ref<Boolean>(false)\nconst user = ref<any>({})\n\nconst editedUser = ref<any>({})\n\nconst colleges = ref<any>([])\nconst getPersonal = async () => {\n  const res = await getPersonalInf()\n  console.log(res)\n  user.value.name = res.data.name\n  // user.value.img=res.data.img\n  user.value.college = res.data.dept.deptName\n  user.value.studentId = res.data.userName\n  user.value.nickName = res.data.nickName\n  user.value.phonenumber = res.data.phonenumber\n  user.value.img = res.data.avatar === '' ? '../../../static/my/headpic.png' : res.data.avatar\n  editedUser.value = res.data\n}\nonLoad(() => {\n  getA()\n})\nonShow(() => {\n  getA()\n  getPersonal()\n})\n\nconst changeUserInfo = () => {\n  getPersonal()\n  isDisabled.value = !isDisabled.value\n}\n\nconst saveEdit = () => {\n  if (!/^1[3456789]\\d{9}$/.test(editedUser.value.phonenumber)) {\n    uni.showToast({\n      title: '请输入正确的手机号',\n      icon: 'none',\n    })\n    return false\n  }\n  if (editedUser.value.nickName && editedUser.value.phonenumber) {\n    console.log(editedUser.value)\n    changePersonalInf(editedUser.value).then((res) => {\n      console.log(res)\n      if (res.code == 500) {\n        uni.showToast({\n          title: '违规操作！',\n          icon: 'none',\n        })\n        return false\n      }\n      getPersonal()\n    })\n    isDisabled.value = !isDisabled.value\n  } else {\n    uni.showToast({\n      title: '请填写完整信息',\n      icon: 'none',\n    })\n  }\n}\n\nconst cancelEdit = () => {\n  isDisabled.value = !isDisabled.value\n}\n\nconst logout = () => {\n  uni.showModal({\n    title: '提示',\n    content: '确定退出登录吗？',\n    success: (res) => {\n      if (res.confirm) {\n        // 清除token\n        uni.removeStorageSync('token')\n        uni.showToast({\n          title: '退出成功',\n          icon: 'success',\n          duration: 2000,\n        })\n        setTimeout(() => {\n          uni.reLaunch({\n            url: '/pages/login/login',\n          })\n        }, 2000)\n      } else if (res.cancel) {\n        console.log('用户点击取消')\n      }\n    },\n  })\n}\nconst editPassword = () => {\n  uni.navigateTo({\n    url: '/pages/my/components/editPassword',\n  })\n}\n</script>\n<style lang=\"scss\">\n.user {\n  width: 90%;\n  margin: 0 auto;\n\n  .item {\n    display: flex;\n    width: 100%;\n    height: 130rpx;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid #e5e3e3;\n\n    .texts {\n      max-width: 65%;\n      display: flex;\n      justify-content: space-between;\n      flex-wrap: nowrap;\n      align-items: center;\n\n      .text1 {\n        margin-right: 5rpx;\n        color: #8e8d8d;\n      }\n\n      image {\n        width: 40rpx;\n        height: 40rpx;\n      }\n    }\n  }\n\n  .avatar {\n    height: 200rpx;\n\n    .user-avatar {\n      .img {\n        width: 80rpx;\n        height: 80rpx;\n      }\n    }\n  }\n\n  .btns {\n    border-bottom: none;\n    display: flex;\n    flex-direction: column;\n    button {\n      margin-top: 20rpx;\n      width: 100%;\n      background-color: #eeeded;\n    }\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/whhbbb/Documents/Project-storage/xswc_game/src/pages/my/components/editUser.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getAudit","getPersonalInf","onLoad","onShow","uni","changePersonalInf"],"mappings":";;;;;;;;;;;;;;;;;;AAkEM,UAAA,mBAAmBA,kBAAa,KAAK;AAC3C,UAAM,OAAO,YAAY;AACjB,YAAA,MAAM,MAAMC,eAAAA;AAClB,cAAQ,IAAI,GAAG;AACf,uBAAiB,QAAQ,IAAI;AAAA,IAAA;AAEzB,UAAA,aAAaD,kBAAa,KAAK;AAC/B,UAAA,OAAOA,kBAAS,CAAA,CAAE;AAElB,UAAA,aAAaA,kBAAS,CAAA,CAAE;AAEbA,kBAAAA,IAAS,CAAA,CAAE;AAC5B,UAAM,cAAc,YAAY;AACxB,YAAA,MAAM,MAAME,qBAAAA;AAClB,cAAQ,IAAI,GAAG;AACV,WAAA,MAAM,OAAO,IAAI,KAAK;AAE3B,WAAK,MAAM,UAAU,IAAI,KAAK,KAAK;AAC9B,WAAA,MAAM,YAAY,IAAI,KAAK;AAC3B,WAAA,MAAM,WAAW,IAAI,KAAK;AAC1B,WAAA,MAAM,cAAc,IAAI,KAAK;AAC7B,WAAA,MAAM,MAAM,IAAI,KAAK,WAAW,KAAK,mCAAmC,IAAI,KAAK;AACtF,iBAAW,QAAQ,IAAI;AAAA,IAAA;AAEzBC,kBAAAA,OAAO,MAAM;AACN;IAAA,CACN;AACDC,kBAAAA,OAAO,MAAM;AACN;AACO;IAAA,CACb;AAED,UAAM,iBAAiB,MAAM;AACf;AACD,iBAAA,QAAQ,CAAC,WAAW;AAAA,IAAA;AAGjC,UAAM,WAAW,MAAM;AACrB,UAAI,CAAC,oBAAoB,KAAK,WAAW,MAAM,WAAW,GAAG;AAC3DC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACM,eAAA;AAAA,MACT;AACA,UAAI,WAAW,MAAM,YAAY,WAAW,MAAM,aAAa;AACrD,gBAAA,IAAI,WAAW,KAAK;AAC5BC,6BAAAA,kBAAkB,WAAW,KAAK,EAAE,KAAK,CAAC,QAAQ;AAChD,kBAAQ,IAAI,GAAG;AACX,cAAA,IAAI,QAAQ,KAAK;AACnBD,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,YAAA,CACP;AACM,mBAAA;AAAA,UACT;AACY;QAAA,CACb;AACU,mBAAA,QAAQ,CAAC,WAAW;AAAA,MAAA,OAC1B;AACLA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AAAA,MACH;AAAA,IAAA;AAGF,UAAM,aAAa,MAAM;AACZ,iBAAA,QAAQ,CAAC,WAAW;AAAA,IAAA;AAGjC,UAAM,SAAS,MAAM;AACnBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AAEfA,gCAAI,kBAAkB,OAAO;AAC7BA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,cACN,UAAU;AAAA,YAAA,CACX;AACD,uBAAW,MAAM;AACfA,4BAAAA,MAAI,SAAS;AAAA,gBACX,KAAK;AAAA,cAAA,CACN;AAAA,eACA,GAAI;AAAA,UAAA,WACE,IAAI,QAAQ;AACrB,oBAAQ,IAAI,QAAQ;AAAA,UACtB;AAAA,QACF;AAAA,MAAA,CACD;AAAA,IAAA;AAEH,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MAAA,CACN;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnKH,GAAG,WAAW,eAAe;"}