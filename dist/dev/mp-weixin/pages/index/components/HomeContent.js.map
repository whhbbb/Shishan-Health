{"version":3,"file":"HomeContent.js","sources":["../../../../../../src/pages/index/components/HomeContent.vue","../../../../../../uniComponent:/L1VzZXJzL3doaGJiYi9Eb2N1bWVudHMvUHJvamVjdC1zdG9yYWdlL3hzd2NfZ2FtZS9zcmMvcGFnZXMvaW5kZXgvY29tcG9uZW50cy9Ib21lQ29udGVudC52dWU"],"sourcesContent":["<template>\n  <view class=\"category\">\n    <view class=\"join\">\n      <view class=\"sub-title\" @click=\"tapJoin\">\n        已预约\n        <image class=\"sub-title-img\" src=\"../../../static/bottomBar/Vector.png\" />\n      </view>\n      <view class=\"sign-in\" @click=\"tapSignIn\">\n        <image class=\"sign-in-img\" src=\"../../../static/bottomBar/sign-in.png\" />\n        签到\n      </view>\n    </view>\n    <navigator v-if=\"activity.length>0\" :url=\"`/pages/activity/ActivityDetails?id=${activity[0].activityId}`\" class=\"example\">\n      <view class=\"title\">{{ activity[0].userImg2 }}</view>\n      <view class=\"time\">\n        <image class=\"example-img\" src=\"../../../static/bottomBar/sign-in-black.png\" />\n        {{ activity[0].lat }}\n      </view>\n      <view class=\"college\">\n        <image class=\"example-img\" src=\"../../../static/activity/loco.png\" />\n        {{ activity[0].hbKeyword }}\n      </view>\n      <view class=\"more\" @tap.stop=\"switchToActs\">\n        查看更多预约 \n        <image\n          class=\"more-img\"\n          src=\"../../../static/my/arrow-right.png\"\n          mode=\"scaleToFill\"\n        />\n      </view>\n    </navigator>\n  </view>\n  <view class=\"activity\">\n    <view class=\"activity-box\">\n      <view class=\"activity-box-content\">活动一览</view>\n      <view class=\"activity-box-select\">\n        <uni-data-select v-model=\"status\" :localdata=\"(statusList as any)\" @change=\"change\" placeholder=\"全部\"\n          :clear=\"false\">\n        </uni-data-select>\n      </view>\n    </view>\n    <view class=\"activity-details\">\n      <navigator class=\"activity-details-item\" v-for=\"item in activities\" :key=\"item.id\" hover-class=\"none\"\n        :url=\"`/pages/activity/ActivityDetails?id=${item.id}`\">\n        <view class=\"img-view\">\n          <image :src=\"item.img\" mode=\"scaleToFill\" />\n        </view>\n\n        <view class=\"info-view\">\n\n          <view class=\"title\">\n            <span class=\"title-content\">\n              {{ item.title }}\n            </span>\n          </view>\n\n          <view class=\"detail-info\">\n\n            <!-- <view class=\"sponsor\"> 发起学院：{{ item.sponsorCollege }} </view> -->\n\n            <view class=\"activity-details-item-content-time\">\n              <view>\n                <image class=\"img\" src=\"../../../static/bottomBar/sign-in-black.png\" />\n              </view>\n              <view>{{ item.time }}</view>\n            </view>\n\n            <view class=\"activity-details-item-content-address\">\n              <image class=\"img\" src=\"../../../static/activity/loco.png\" />{{ item.address }}\n            </view>\n\n            <!-- <view v-if=\"isCanApply(item)\" class=\"activity-details-item-content-status\">\n              <view class=\"status\">可报名</view>\n            </view> -->\n          </view>\n        </view>\n\n      </navigator>\n    </view>\n    <view class=\"loading-text\">\n      <uni-load-more :status=\"finish\"></uni-load-more>\n    </view>\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport { getHomeContentAPI, giftIsShow } from '@/services/HomeContent'\nimport { onLoad, onShow, onHide } from '@dcloudio/uni-app'\nimport { ref, reactive } from 'vue'\nimport { getMyActivityAPI } from '@/services/my'\nconst status = ref<string>('全部')\nconst statusN = ref<Number>(0)\nconst activity = ref<any>({})\n// 当前所有的页数\nconst pageNum = ref<number>(1)\nconst pageSize = 10\nconst totalNum = ref<number>(0)\nconst finish = ref<string>('more')\n// 表示当前所在的类别\nconst nowList = ref<number>(0)\n// const query = uni.createSelectorQuery().in(this)\n// query.select('.scroll-view').boundingClientRect((data)=>{\n//   this.height=`height:${data.height}px;`;\n// }).exec()\nconst statusList = ref([\n  { value: 0, text: '全部' },\n  { value: 1, text: '进行中' },\n  { value: 2, text: '已结束' },\n  { value: 3, text: '精选' },\n])\nconst change = (e: any, tag = 1) => {\n  if (tag === 1) {\n    finish.value = 'more'\n    activities.value = []\n    pageNum.value = 1\n  }\n  console.log(e)\n  nowList.value = e;\n  if (e === 0) {\n    statusN.value = 0\n    getHomeContent(0, 0, 0, pageNum.value)\n  } else if (e === 1) {\n    statusN.value = 1\n    getHomeContent(1, 2, 1, pageNum.value)\n  } else if (e === 2) {\n    statusN.value = 2\n    getHomeContent(1, 2, 2, pageNum.value)\n  } else {\n    statusN.value = 3\n    getHomeContent(2, 2, 1, pageNum.value)\n  }\n}\n// 获得当前预约的活动\nconst getMyActivity = async () => {\n  if(!uni.getStorageSync('token')){\n    return;\n  }\n  let res = await getMyActivityAPI()\n  if (res.code === 200) {\n    activity.value = res.data\n  } else {\n    uni.showToast({\n      title: '查询已预约失败',\n      icon: 'none',\n    })\n  }\n}\ntype Category = {\n  id: number\n  text: string\n  icon: string\n  url: any\n}\ntype Activity = {\n  id: number\n  title: string\n  status: string\n  time: string\n  address: string\n  img?: string\n  // 报名人数和限制人数\n  population?: number\n  limitPopulation?: number\n  // 发起学院\n  sponsorCollege: string\n  // 活动种类\n  sort: number\n  lng: string\n  isClose: number\n  isApplication:Array<Object>\n  hot:number\n  hbNum:number\n}\nconst activities = ref<Activity[]>([])\n\n// 点击已预约\nconst tapJoin = () => {\n  uni.navigateTo({\n    url: '/pages/my/components/myactivity/activity',\n  })\n}\n\n// 点击签到\nconst tapSignIn = () => {\n  uni.navigateTo({\n    url: '/pages/activity/ActivitySignIn',\n  })\n}\n\nconst getHomeContent = async (type: number, state: number, isEnd: number, pageNum = 1, pageSize = 10) => {\n  // 获取首页内容\n  let res\n  uni.showLoading({\n    title: '加载中',\n  })\n  finish.value = 'loading'\n  if (type === 0) {\n    res = await getHomeContentAPI({ state: 2, pageNum: pageNum, pageSize: pageSize })\n  } else if (type == 1) {\n    res = await getHomeContentAPI({ state: state, isEnd: isEnd, pageNum: pageNum, pageSize: pageSize })\n  } else {\n    res = await getHomeContentAPI({ type: type, state: state, pageNum: pageNum, pageSize: pageSize })\n  }\n  uni.hideLoading()\n  finish.value = 'more'\n  if (res.code === 200) {\n    totalNum.value = res.total\n    let innerActivities = res.rows.map((item: any) => ({\n      id: item.id,\n      title: item.userImg2,\n      img: item.lng,\n      status: item.isEnd == 1 ? '进行中' : '已结束',\n      time: item.lat,\n      address: item.address,\n      sponsorCollege: item.hbKeyword,\n      population: item.hbNum,\n      limitPopulation: item.hot,\n      sort: item.sort,\n      lng: item.lng,\n      isClose: item.isClose,\n      isApplication: item.isApplication,\n      hot: item.hot,\n      hbNum: item.hbNum\n    }))\n    activities.value.push(...innerActivities)\n    if (activities.value.length === 0) {\n      uni.showToast({\n        title: '暂无活动',\n        icon: 'none',\n      })\n      finish.value = 'no-more'\n    }\n    if (pageNum * pageSize >= totalNum.value) {\n      finish.value = 'no-more'\n      // uni.showToast({ icon: 'none', title: '没有更多数据了~' })\n    }\n  } else {\n    uni.showToast({\n      title: '查询失败',\n      icon: 'none',\n    })\n  }\n}\n// 分页查询\nconst onScrolltolower = () => {\n  if (pageNum.value * pageSize >= totalNum.value) {\n    finish.value = 'no-more'\n    return uni.showToast({ icon: 'none', title: '没有更多数据了~' })\n  } else {\n    pageNum.value += 1;\n  }\n  change(nowList.value, 2)\n}\n// 跳转到我的活动\nconst switchToActs = () => {\n  uni.navigateTo({\n    url: '/pages/my/components/myactivity/activity',\n  })\n}\n// 可报名判断\n// const isCanApply = (item: Activity) => {\n//   if (item.isClose === 1 && !item.isApplication && item.hot > item.hbNum) {\n//     return true\n//   }\n//   return false\n// }\nonLoad(() => {\n  uni.onNetworkStatusChange((res) => {\n    if (!res.isConnected) {\n      uni.showToast({\n        title: '网络已断开',\n        icon: 'none',\n      })\n    }\n  })\n  getHomeContent(0, 0, 0)\n  getMyActivity()\n  uni.$on('scrolltolower', onScrolltolower)\n})\nonHide(() => { })\n// onShow(() => {\n//   if (statusN.value === 0) {\n//     getHomeContent(0, 0, 0)\n//   } else if (statusN.value === 1) {\n//     getHomeContent(1, 2, 1)\n//   } else if (statusN.value === 2) {\n//     getHomeContent(1, 2, 2)\n//   } else {\n//     getHomeContent(2, 2, 1)\n//   }\n// })\n</script>\n\n<style lang=\"scss\">\n.category {\n  width: 85%;\n  margin: 50rpx auto;\n  display: flex;\n  flex-direction: column;\n\n  .join {\n    display: flex;\n    justify-content: space-between;\n\n    .sub-title {\n      font-size: 40rpx;\n      font-weight: bold;\n      color: #333;\n      display: flex;\n      align-items: center;\n\n      .sub-title-img {\n        color: #908f8f;\n        width: 18rpx;\n        height: 25rpx;\n        margin-left: 10rpx;\n      }\n    }\n\n    .sign-in {\n      width: 180rpx;\n      height: 80rpx;\n      border-radius: 15rpx;\n      background-color: #0077b6;\n      color: #fff;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n\n      .sign-in-img {\n        width: 55rpx;\n        height: 55rpx;\n        margin-right: 6rpx;\n      }\n    }\n  }\n  .example{\n    position: relative;\n    width: 100%;\n    background-color: #fff;\n    box-shadow: 0 0 20px #e5e4e4;\n    border-radius: 20rpx;\n    margin-top: 20rpx;\n    padding: 20rpx;\n    display: flex;\n    flex-direction: column;\n    .title{\n      font-size: 30rpx;\n    }\n    .time,.college{\n      font-size: 25rpx;\n      color: #666;\n      margin-top: 10rpx;\n    }\n    .example-img{\n      width: 30rpx;\n      height: 30rpx;\n      margin-right: 6rpx;\n    }\n    .more{\n      position: absolute;\n      color: #abacac;\n      font-size: 25rpx;\n      right: 20rpx;\n      bottom: 30rpx;\n      .more-img{\n        width: 20rpx;\n        height: 20rpx;\n        color: #666;\n      }\n    }\n  }\n}\n\n.activity {\n  // height: 50%;\n  display: flex;\n  flex-direction: column;\n  min-height: 100rpx;\n\n  .activity-box {\n    display: flex;\n    justify-content: space-between;\n    width: 85%;\n    margin: 0rpx auto;\n\n    .activity-box-content {\n      font-size: 30rpx;\n      font-weight: bold;\n      padding-top: 20rpx;\n      color: #333;\n    }\n\n    .activity-box-select {\n      float: right;\n      width: 160rpx;\n      z-index: 99;\n      background-color: #fff;\n      box-shadow: 0 0 20px #e5e4e4;\n      border-radius: 15rpx;\n    }\n  }\n\n\n  .activity-details {\n    width: 85%;\n    margin: 20rpx auto;\n\n    .activity-details-item {\n      background-color: #fff;\n      box-shadow: 0 0 20px #e5e4e4;\n      height: 380rpx;\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      align-items: flex-start;\n      width: 100%;\n      padding: 30rpx;\n      border-radius: 20rpx;\n      margin-bottom: 30rpx;\n\n      .img-view {\n        width: 40%;\n        height: 100%;\n        margin-right: 32rpx;\n        image{\n          border-radius: 8rpx;\n        }\n      }\n\n      .info-view {\n\n        flex: 1;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n\n        .title {\n          font-size: 30rpx;\n          color: #000000;\n          margin-bottom: 30rpx;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          -webkit-line-clamp: 3;\n          display: -webkit-box;\n          -webkit-box-orient: vertical;\n        }\n\n        .detail-info {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n\n          .sponsor {\n            margin-bottom: 10rpx;\n            font-size: 33rpx;\n            margin-bottom: 20rpx;\n          }\n\n          .activity-details-item-content-time {\n            position: relative;\n            font-size: 25rpx;\n            width: 200rpx;\n            color: #666666;\n            overflow: hidden;\n            margin-bottom: 20rpx;\n            display: flex;\n            flex-direction: row;\n\n            .img {\n              position: relative;\n              top: 0;\n              width: 30rpx;\n              height: 30rpx;\n              margin-right: 10rpx;\n            }\n          }\n\n          .activity-details-item-content-address {\n            font-size: 25rpx;\n            color: #666666;\n\n            .img {\n              width: 30rpx;\n              height: 30rpx;\n              margin-right: 10rpx;\n            }\n          }\n          .activity-details-item-content-status{\n            flex: 1;          \n            display: flex;\n            align-items: flex-end;\n            .status{\n              font-size: 28rpx;\n              font-weight: bold;\n              color: #0077b6;\n            }\n          }\n        }\n\n      }\n    }\n  }\n}\n</style>","import Component from '/Users/whhbbb/Documents/Project-storage/xswc_game/src/pages/index/components/HomeContent.vue'\nwx.createComponent(Component)"],"names":["ref","uni","getMyActivityAPI","pageNum","pageSize","getHomeContentAPI","onLoad","onHide"],"mappings":"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"}