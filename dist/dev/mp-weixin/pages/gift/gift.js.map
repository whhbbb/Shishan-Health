{"version":3,"file":"gift.js","sources":["../../../../../src/pages/gift/gift.vue","../../../../../uniPage:/cGFnZXMvZ2lmdC9naWZ0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <div class=\"main\" :style=\"{ paddingBottom: safeAreaInsets?.bottom!+ 0 + 'px' }\">\r\n    <view class=\"swiper-wrapper\">\r\n      <swiper\r\n        class=\"swiper\"\r\n        :indicator-dots=\"indicatorDots\"\r\n        :autoplay=\"autoplay\"\r\n        :interval=\"interval\"\r\n        :duration=\"duration\"\r\n      >\r\n        <swiper-item v-for=\"(url, index) in goodsdata.imgs\" :key=\"index\" @click=\"previewImage\">\r\n          <image :src=\"url\" mode=\"aspectFill\" class=\"image_detail\" />\r\n        </swiper-item>\r\n      </swiper>\r\n    </view>\r\n\r\n    <scroll-view class=\"scroll-view\" :scroll-y=\"true\">\r\n      <view class=\"detail\">\r\n        <!-- <text class=\"price\">{{ goodsdata.price }}积分</text> -->\r\n        <view class=\"title-view\">\r\n          <view class=\"title\">{{ goodsdata.name }}</view>\r\n          <view class=\"right-part\">\r\n            <view class=\"need-score\">\r\n              <image\r\n                class=\"score-img\"\r\n                src=\"../../static/gifts/score.png\"\r\n                mode=\"scaleToFill\"\r\n              />\r\n              <text>{{ goodsdata.price }}积分</text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n        <uni-tag\r\n          class=\"tag\"\r\n          :text=\"`总库存：${goodsdata.allnums}`\"\r\n          size=\"mini\"\r\n          :inverted=\"true\"\r\n          type=\"success\"\r\n        />\r\n        <text class=\"text-remark\">{{ goodsdata.introduce }}</text>\r\n      </view>\r\n      <view class=\"temp\"></view>\r\n    </scroll-view>\r\n\r\n    <view class=\"detail-nav\" :style=\"{ bottom: safeAreaInsets?.bottom!+ 0 + 'px' }\">\r\n      <view class=\"num-box\">\r\n        <uni-number-box\r\n          class=\"numchooseBox\"\r\n          @blur=\"blur\"\r\n          :max=\"maxNum\"\r\n          v-model=\"goodsnum\"\r\n        ></uni-number-box>\r\n      </view>\r\n      <view class=\"score-box\">\r\n        <image\r\n          class=\"score-img\"\r\n          src=\"../../static/gifts/blue-score.png\"\r\n        />\r\n        <view class=\"scorenum\">{{ scoreres }}</view>\r\n        <view class=\"text\">立即兑换</view>\r\n      </view>\r\n      <!-- <button :disabled=\"goodsnum == 0\" class=\"button-red\" @click=\"immeBuy\" formType=\"submit\">\r\n        立即兑换\r\n      </button> -->\r\n    </view>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n// import { ref, reactive } from 'vue'\r\n// import { onLoad } from '@dcloudio/uni-app';\r\n\r\n// onLoad(() => {\r\n//   uni.showToast({\r\n//     title: '礼品中心部分功能尚未实现，敬请期待~',\r\n//     icon: 'none',\r\n//     duration: 2000,\r\n//     complete: function () {\r\n//       setTimeout(function () {\r\n//         uni.switchTab({\r\n//           url: '/pages/index/index'\r\n//         });\r\n//       }, 2000); // 在弹窗关闭后，延迟2秒执行页面跳转\r\n//     }\r\n//   })\r\n// })\r\n\r\nimport { onLoad, onShow } from '@dcloudio/uni-app'\r\nimport { ref, computed, watch } from 'vue'\r\nimport { getGiftDetail, exchangeGift } from '@/services/gift'\r\nimport { getPersonalInf } from '@/services/personalInf'\r\n// 获取屏幕边界到安全区域距离\r\nconst { safeAreaInsets } = uni.getSystemInfoSync()\r\n\r\nconst props = defineProps<{\r\n  id: number\r\n}>()\r\n\r\nconst goodsnum = ref<number>(0)\r\nconst goodsdata = ref<any>({})\r\n\r\nconst getGiftDetails = async (id) => {\r\n  const res = await getGiftDetail(id)\r\n  console.log(res.data)\r\n  goodsdata.value = res.data\r\n}\r\nconst getMyCredit = async () => {\r\n  const res = await getPersonalInf()\r\n  console.log(res.data.credit)\r\n  mycredit.value = res.data.credit\r\n}\r\nconst mycredit = ref<number>(1)\r\nconst blur = (e) => {\r\n  console.log(e)\r\n  if (e.detail.value > goodsdata.value.allnums) {\r\n    uni.showToast({\r\n      title: '兑换数量超出库存',\r\n      icon: 'none',\r\n      duration: 1000,\r\n    })\r\n  }\r\n}\r\nconst maxNum = computed(() => {\r\n  if (mycredit.value == 0) {\r\n    return 0\r\n  }\r\n  return goodsdata.value.allnums\r\n})\r\nconst scoreres = computed(() => {\r\n  return (goodsnum.value * goodsdata.value.price).toFixed(2)\r\n})\r\n// watch([goodsnum.value, () => goodsdata.value.price], ([newgoodsnum]) => {\r\n//   scoreres.value = newgoodsnum * goodsdata.value.price;\r\n// });\r\nonShow(() => {\r\n  if (uni.getStorageSync('token')) {\r\n    getMyCredit()\r\n  }\r\n})\r\nonLoad(() => {\r\n  if (uni.getStorageSync('token')) {\r\n    console.log(props.id)\r\n    getGiftDetails(props.id)\r\n    getMyCredit()\r\n  } else {\r\n    wx.showToast({\r\n      title: '您尚未登录，请先登录',\r\n      icon: 'none',\r\n      duration: 1000,\r\n      complete: () => {\r\n        setTimeout(() => {\r\n          uni.navigateTo({\r\n            url: '/pages/login/login',\r\n          })\r\n        }, 1000)\r\n      },\r\n    })\r\n  }\r\n})\r\n\r\nconst indicatorDots = true\r\nconst autoplay = true\r\nconst interval = 3000\r\nconst duration = 1000\r\n\r\nconst previewImage = (e) => {\r\n  var current = e.target.dataset.src\r\n  console.log(current)\r\n  wx.previewImage({\r\n    current: current,\r\n    urls: goodsdata.value.imgs,\r\n  })\r\n}\r\n\r\nconst applyExchange = async (data) => {\r\n  const res = await exchangeGift(data)\r\n  console.log(res)\r\n  if (res.code == 200) {\r\n    if (res.data == 3) {\r\n      uni.showToast({\r\n        title: '兑换成功！',\r\n        icon: 'success',\r\n        duration: 2000,\r\n        complete: function () {\r\n          setTimeout(function () {\r\n            getGiftDetails(props.id)\r\n            getMyCredit()\r\n            goodsnum.value = 0\r\n            // uni.navigateTo({\r\n            //   url: '/pages/gift/giftCenter',\r\n            // })\r\n          }, 2000) // 在弹窗关闭后，延迟2秒执行页面跳转\r\n        },\r\n      })\r\n    }\r\n    if (res.data == 2) {\r\n      uni.showToast({\r\n        title: '余额不足！',\r\n        icon: 'error',\r\n        duration: 2000,\r\n      })\r\n    }\r\n    if (res.data == 1) {\r\n      uni.showToast({\r\n        title: '库存不足！',\r\n        icon: 'error',\r\n        duration: 2000,\r\n      })\r\n    }\r\n  }\r\n}\r\nconst immeBuy = () => {\r\n  console.log('购买')\r\n  if (mycredit.value < goodsnum.value * goodsdata.value.price) {\r\n    uni.showToast({\r\n      title: '剩余积分不足',\r\n      icon: 'error',\r\n      duration: 1000,\r\n    })\r\n    return\r\n  }\r\n  wx.showModal({\r\n    title: '确认兑换',\r\n    content: '确定要兑换吗？',\r\n    success(res) {\r\n      if (res.confirm) {\r\n        //用户点击了确认按钮\r\n        applyExchange({\r\n          id: null,\r\n          goodsId: goodsdata.value.id,\r\n          nums: goodsnum.value,\r\n        })\r\n      } else if (res.cancel) {\r\n        // 用户点击了取消按钮\r\n        console.log('用户取消了兑换')\r\n      }\r\n    },\r\n  })\r\n}\r\n</script>\r\n<style scoped lang=\"scss\">\r\npage {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n}\r\n.main{\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  align-items: center;\r\n}\r\n/* 直接设置swiper属性 */\r\n.swiper-wrapper{\r\n  margin-top: 20rpx;\r\n  height: 800rpx;\r\n  width: 100%;\r\n  .swiper{\r\n    width: 82%;\r\n    height: 100%;\r\n    margin: 0 auto;\r\n    border-radius: 20rpx;\r\n  }\r\n}\r\nswiper-item image {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n.separate {\r\n  height: 20rpx;\r\n  background-color: whitesmoke;\r\n  margin-top: 10rpx;\r\n  width: 100%;\r\n}\r\n.scroll-view {\r\n  height: 100%;\r\n  width: 82%;\r\n  margin: 0 auto;\r\n  background-color: #fff;\r\n}\r\n.goodsimg {\r\n  height: 600rpx;\r\n  width: 100%;\r\n  display: flex;\r\n  justify-content: space-around;\r\n}\r\n.detail {\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin: 15rpx 10rpx 0;\r\n}\r\n.detail .title {\r\n  font-size: 40rpx;\r\n  color: black;\r\n  text-align: justify;\r\n}\r\n.detail .price {\r\n  color: red;\r\n  font-size: 40rpx;\r\n  margin: 10rpx;\r\n  margin-top: 30rpx;\r\n}\r\n.title-view {\r\n  margin: 10rpx 0;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  .right-part {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    .need-score {\r\n      display: flex;\r\n      align-items: center;\r\n      font-size: 25rpx;\r\n      .score-img {\r\n        width: 30rpx;\r\n        height: 30rpx;\r\n        margin-right: 5rpx;\r\n      }\r\n    }\r\n  }\r\n}\r\n.tag {\r\n  margin-bottom: 10rpx;\r\n}\r\n.line_flag {\r\n  width: 80rpx;\r\n  height: 1rpx;\r\n  display: inline-block;\r\n  margin: 20rpx auto;\r\n  background-color: gainsboro;\r\n  text-align: center;\r\n}\r\n.line {\r\n  width: 100%;\r\n  height: 2rpx;\r\n  display: inline-block;\r\n  margin: 20rpx 0rpx;\r\n  background-color: gainsboro;\r\n  text-align: center;\r\n}\r\n.detail-nav {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  background-color: #fff;\r\n  position: fixed;\r\n  bottom: 0;\r\n  z-index: 100;\r\n  width: 82%;\r\n  margin: 0 auto;\r\n  height: 100rpx;\r\n  border-top: 1rpx solid #f0f0f0;\r\n  .num-box{\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    margin-right: 20rpx;\r\n  }\r\n  .score-box{\r\n    background-color: #D4EDF5;\r\n    height: 80%;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    border-radius: 10rpx;\r\n    margin-left: 20rpx;\r\n    .score-img{\r\n      width: 30rpx;\r\n      height: 30rpx;\r\n    }\r\n    .scorenum{\r\n      color: #0077B6;\r\n      font-size: 30rpx;\r\n      font-weight: bold;\r\n      margin-left: -20rpx;\r\n    }\r\n    .text{\r\n      font-size: 30rpx;\r\n      font-weight: bold;\r\n      margin: 10rpx;\r\n      color: #0077B6;\r\n    }\r\n  }\r\n}\r\n.goodsdimg {\r\n  margin-bottom: 7px;\r\n}\r\n.image_detail {\r\n  width: 100%;\r\n}\r\n.detail-nav image {\r\n  width: 70rpx;\r\n  height: 50rpx;\r\n  margin: 20rpx 40rpx;\r\n}\r\n.line_nav {\r\n  width: 100%;\r\n  background-color: #fff;\r\n  position: fixed;\r\n  bottom: 0;\r\n}\r\n/* 占位 */\r\n.temp {\r\n  height: 100rpx;\r\n}\r\ntext {\r\n  display: block;\r\n  /* height: 50rpx; */\r\n  line-height: 50rpx;\r\n  /* font-size: 30rpx; */\r\n  margin: 10rpx;\r\n}\r\n.text-remark {\r\n  display: block;\r\n  font-size: 27rpx;\r\n}\r\n.num-box {\r\n  font-size: 27rpx;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n}\r\n.score-box {\r\n  width: 82%;\r\n  margin: 0 auto;\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n}\r\n.scorenum {\r\n  color: #f44336;\r\n  display: block;\r\n  font-size: 30rpx;\r\n  margin: 10rpx;\r\n}\r\n.numchooseBox {\r\n  margin: auto 0;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/feidian/计算机设计大赛/xswc_cs/src/pages/gift/gift.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getGiftDetail","getPersonalInf","computed","onShow","onLoad","wx"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AA4FA,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAM3C,UAAA,WAAWC,kBAAY,CAAC;AACxB,UAAA,YAAYA,kBAAS,CAAA,CAAE;AAEvB,UAAA,iBAAiB,OAAO,OAAO;AAC7B,YAAA,MAAM,MAAMC,4BAAc,EAAE;AAC1B,cAAA,IAAI,IAAI,IAAI;AACpB,gBAAU,QAAQ,IAAI;AAAA,IAAA;AAExB,UAAM,cAAc,YAAY;AACxB,YAAA,MAAM,MAAMC,qBAAAA;AACV,cAAA,IAAI,IAAI,KAAK,MAAM;AAClB,eAAA,QAAQ,IAAI,KAAK;AAAA,IAAA;AAEtB,UAAA,WAAWF,kBAAY,CAAC;AACxB,UAAA,OAAO,CAAC,MAAM;AAClB,cAAQ,IAAI,CAAC;AACb,UAAI,EAAE,OAAO,QAAQ,UAAU,MAAM,SAAS;AAC5CD,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,QAAA,CACX;AAAA,MACH;AAAA,IAAA;AAEI,UAAA,SAASI,cAAAA,SAAS,MAAM;AACxB,UAAA,SAAS,SAAS,GAAG;AAChB,eAAA;AAAA,MACT;AACA,aAAO,UAAU,MAAM;AAAA,IAAA,CACxB;AACK,UAAA,WAAWA,cAAAA,SAAS,MAAM;AAC9B,cAAQ,SAAS,QAAQ,UAAU,MAAM,OAAO,QAAQ,CAAC;AAAA,IAAA,CAC1D;AAIDC,kBAAAA,OAAO,MAAM;AACP,UAAAL,cAAA,MAAI,eAAe,OAAO,GAAG;AACnB;MACd;AAAA,IAAA,CACD;AACDM,kBAAAA,OAAO,MAAM;AACP,UAAAN,cAAA,MAAI,eAAe,OAAO,GAAG;AACvB,gBAAA,IAAI,MAAM,EAAE;AACpB,uBAAe,MAAM,EAAE;AACX;MAAA,OACP;AACLO,sBAAAA,KAAG,UAAU;AAAA,UACX,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,UACV,UAAU,MAAM;AACd,uBAAW,MAAM;AACfP,4BAAAA,MAAI,WAAW;AAAA,gBACb,KAAK;AAAA,cAAA,CACN;AAAA,eACA,GAAI;AAAA,UACT;AAAA,QAAA,CACD;AAAA,MACH;AAAA,IAAA,CACD;AAED,UAAM,gBAAgB;AACtB,UAAM,WAAW;AACjB,UAAM,WAAW;AACjB,UAAM,WAAW;AAEX,UAAA,eAAe,CAAC,MAAM;AACtB,UAAA,UAAU,EAAE,OAAO,QAAQ;AAC/B,cAAQ,IAAI,OAAO;AACnBO,oBAAAA,KAAG,aAAa;AAAA,QACd;AAAA,QACA,MAAM,UAAU,MAAM;AAAA,MAAA,CACvB;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1KH,GAAG,WAAW,eAAe;"}