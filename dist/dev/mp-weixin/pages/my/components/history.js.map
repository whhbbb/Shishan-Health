{"version":3,"file":"history.js","sources":["../../../../../../src/pages/my/components/history.vue","../../../../../../uniPage:/cGFnZXMvbXkvY29tcG9uZW50cy9oaXN0b3J5LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"wrapper\">\n    <view class=\"credit-sum\">\n      <view class=\"credit-sum-content\">\n        <view class=\"credit-num\">{{ props.creditNum }}</view>\n        积分\n      </view>\n      <navigator class=\"credit-role\" url=\"/pages/my/components/integral\">\n        积分规则\n        <image\n          class=\"credit-role-img\"\n          src=\"../../../static/my/black-arrow-right.png\"\n          mode=\"heightFix\"\n        />\n      </navigator>\n    </view>\n    <view class=\"credit-details\">\n      <view class=\"month-details\" v-for=\"history in historys\" :key=\"history.month\">\n        <view class=\"month\">{{ history.month }}</view>\n        <view class=\"history-details\" v-for=\"item in history.details\" :key=\"item.id\">\n          <view class=\"history-content\">\n            <view class=\"history-title\">{{ CType(item.creditType) }}</view>\n            <view class=\"history-time\">{{ item.createTime }}</view>\n          </view>\n          <view class=\"history-credit\">{{ editCredit(item.creditType,item.creditNum) }}</view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive } from 'vue'\nimport { onLoad, onShow } from '@dcloudio/uni-app'\n\nimport { getCreidHistory } from '@/services/gift'\n\n// 记录的字段\ninterface History {\n  creditType: number\n  createTime: string\n  creditNum: number\n}\n\n// 获取props\nconst props = defineProps<{\n  creditNum: string\n}>()\nconst historys = ref([])\n\n// 获取积分历史\nconst getCreditH = async () => {\n  const res = await getCreidHistory()\n  console.log(res.rows)\n  historys.value = sortGroupBy(groupBy(res.rows))\n}\n// 积分类型\nconst CType = (n:number) => {\n  if (n == 2) {\n    return '参加活动'\n  } else if (n == 3) {\n    return '意见反馈'\n  } else if (n == 4) {\n    return '推荐活动'\n  } else {\n    return '积分兑换'\n  }\n}\n// 积分数值\nconst editCredit = (n:number,num:number) => {\n  if(n==5){\n    return num\n  }else{\n    return '+'+num\n  }\n}\n//根据日期按月分组记录\nconst groupBy = (array:History[]) => {\n  const map = new Map()\n  array.forEach((item) => {\n    const key = item.createTime.slice(0, 7)\n    if (map.has(key)) {\n      map.get(key).push(item)\n    } else {\n      map.set(key, [item])\n    }\n  })\n  return map\n}\n// 对groupby的结果进行排序\nconst sortGroupBy = (map:Map<string, History[]>) => {\n  const keys = Array.from(map.keys())\n  keys.sort((a, b) => {\n    return a > b ? -1 : 1\n  })\n  return keys.map((key) => {\n    return {\n      month: key,\n      details: map.get(key),\n    }\n  })\n}\n\n\n\nonLoad(() => {\n  if (!uni.getStorageSync('token')) {\n    uni.showToast({\n      title: '您未登录！',\n      icon: 'none',\n      duration: 1000,\n    })\n    return\n  }\n  getCreditH()\n})\nonShow(() => {\n  if (!uni.getStorageSync('token')) {\n    uni.showToast({\n      title: '您未登录！',\n      icon: 'none',\n      duration: 1000,\n    })\n    return\n  }\n})\n</script>\n\n<style lang=\"scss\">\n.wrapper{\n  width: 85%;\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  padding-top: 50rpx;\n  .credit-sum{\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 60rpx;\n    width: 100%;\n    height: 160rpx;\n    border-radius: 20rpx;\n    box-shadow: 0 0 20px #e5e4e4;\n    .credit-sum-content{\n      display: flex;\n      align-items: center;\n      .credit-num{\n        font-size: 55rpx;\n        font-weight: bold;\n        margin-right: 10rpx;\n      }\n    }\n    .credit-role{\n      flex: 1;\n      display: flex;\n      align-items: center;\n      justify-content: flex-end;\n      font-size: 30rpx;\n      .credit-role-img{\n        height: 25rpx;\n        margin-left: 8rpx;\n      }\n    }\n  }\n  .credit-details{\n    display: flex;\n    flex-direction: column;\n    padding: 30rpx;\n    margin-top: 30rpx;\n    border-radius: 20rpx;\n    box-shadow: 0 0 20px #e5e4e4;\n    min-height: 100rpx;\n    .month-details{\n      display: flex;\n      flex-direction: column;\n      .month{\n        font-size: 35rpx;\n        padding-bottom: 20rpx;\n        border-bottom: 1.5px solid #e5e4e4;\n        margin-bottom: 20rpx;\n      }\n      .history-details{\n        display: flex;\n        padding: 0 30rpx;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 30rpx;\n        .history-content{\n          display: flex;\n          flex-direction: column;\n          .history-title{\n            font-size: 32rpx;\n            color: #333;\n          }\n          .history-time{\n            font-size: 25rpx;\n            color: #999;\n          }\n        }\n        .history-credit{\n          display: flex;\n          align-items: center;\n          font-size: 38rpx;\n          color: #000;\n        }\n      }\n    }\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/whhbbb/Documents/Project-storage/xswc_game/src/pages/my/components/history.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getCreidHistory","onLoad","uni","onShow"],"mappings":";;;;;;;;;;;;;AAgDM,UAAA,WAAWA,kBAAI,CAAA,CAAE;AAGvB,UAAM,aAAa,YAAY;AACvB,YAAA,MAAM,MAAMC,cAAAA;AACV,cAAA,IAAI,IAAI,IAAI;AACpB,eAAS,QAAQ,YAAY,QAAQ,IAAI,IAAI,CAAC;AAAA,IAAA;AAG1C,UAAA,QAAQ,CAAC,MAAa;AAC1B,UAAI,KAAK,GAAG;AACH,eAAA;AAAA,MAAA,WACE,KAAK,GAAG;AACV,eAAA;AAAA,MAAA,WACE,KAAK,GAAG;AACV,eAAA;AAAA,MAAA,OACF;AACE,eAAA;AAAA,MACT;AAAA,IAAA;AAGI,UAAA,aAAa,CAAC,GAAS,QAAe;AAC1C,UAAG,KAAG,GAAE;AACC,eAAA;AAAA,MAAA,OACJ;AACH,eAAO,MAAI;AAAA,MACb;AAAA,IAAA;AAGI,UAAA,UAAU,CAAC,UAAoB;AAC7B,YAAA,0BAAU;AACV,YAAA,QAAQ,CAAC,SAAS;AACtB,cAAM,MAAM,KAAK,WAAW,MAAM,GAAG,CAAC;AAClC,YAAA,IAAI,IAAI,GAAG,GAAG;AAChB,cAAI,IAAI,GAAG,EAAE,KAAK,IAAI;AAAA,QAAA,OACjB;AACL,cAAI,IAAI,KAAK,CAAC,IAAI,CAAC;AAAA,QACrB;AAAA,MAAA,CACD;AACM,aAAA;AAAA,IAAA;AAGH,UAAA,cAAc,CAAC,QAA+B;AAClD,YAAM,OAAO,MAAM,KAAK,IAAI,KAAM,CAAA;AAC7B,WAAA,KAAK,CAAC,GAAG,MAAM;AACX,eAAA,IAAI,IAAI,KAAK;AAAA,MAAA,CACrB;AACM,aAAA,KAAK,IAAI,CAAC,QAAQ;AAChB,eAAA;AAAA,UACL,OAAO;AAAA,UACP,SAAS,IAAI,IAAI,GAAG;AAAA,QAAA;AAAA,MACtB,CACD;AAAA,IAAA;AAKHC,kBAAAA,OAAO,MAAM;AACX,UAAI,CAACC,cAAA,MAAI,eAAe,OAAO,GAAG;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,QAAA,CACX;AACD;AAAA,MACF;AACW;IAAA,CACZ;AACDC,kBAAAA,OAAO,MAAM;AACX,UAAI,CAACD,cAAA,MAAI,eAAe,OAAO,GAAG;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,QAAA,CACX;AACD;AAAA,MACF;AAAA,IAAA,CACD;;;;;;;;;;;;;;;;;;;;;;;AC5HD,GAAG,WAAW,eAAe;"}