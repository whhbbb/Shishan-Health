{"version":3,"file":"feedBack.js","sources":["../../../../../../src/pages/my/components/feedBack.vue","../../../../../../uniPage:/cGFnZXMvbXkvY29tcG9uZW50cy9mZWVkQmFjay52dWU"],"sourcesContent":["<template>\n  <view v-if=\"isPastTargetDate\" class=\"feedback\">\n    <view class=\"feedback-item\">\n      <view class=\"feedback-content\">\n        <view class=\"feedback-content-item\">\n          <view class=\"feedback-content-item-title\">问题描述</view>\n          <view class=\"feedback-content-item-input\">\n            <textarea\n              name=\"\"\n              id=\"\"\n              cols=\"30\"\n              rows=\"10\"\n              placeholder=\"请描述您的问题\"\n              v-model=\"feedBack.problem\"\n            ></textarea>\n          </view>\n        </view>\n        <view class=\"feedback-content-item\">\n          <view class=\"feedback-content-item-title\">上传图片</view>\n          <uni-file-picker\n            limit=\"9\"\n            mode=\"grid\"\n            file-mediatype=\"image\"\n            @select=\"select\"\n            @delete=\"deleteImg\"\n          />\n        </view>\n        <view class=\"feedback-content-item\">\n          <view class=\"feedback-content-item-title\">联系人姓名</view>\n          <view class=\"feedback-content-item-input\">\n            <uni-easyinput\n              v-model=\"feedBack.name\"\n              type=\"text\"\n              placeholder=\"请输入您的名字\"\n              @confirm=\"\"\n              next\n            />\n          </view>\n        </view>\n        <view class=\"feedback-content-item\">\n          <view class=\"feedback-content-item-title\">联系方式</view>\n          <view class=\"feedback-content-item-input\">\n            <uni-easyinput\n              v-model=\"feedBack.contact\"\n              type=\"text\"\n              placeholder=\"请输入您的联系方式\"\n              @confirm=\"\"\n              done\n            />\n          </view>\n        </view>\n      </view>\n      <view class=\"feedback-btn\">\n        <button class=\"btn\" type=\"primary\" size=\"default\" @tap=\"submit\">提交</button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport { postFeedbackAPI } from '@/services/feedBack'\nimport { ref, reactive, computed } from 'vue'\nimport { onLoad, onShow } from '@dcloudio/uni-app'\n//过审\n// 获取当前时间点\nconst currentTime = ref(new Date())\n\n// 计算2023年11月17号的时间点\nconst targetDate = new Date('2023-11-23')\n\n// 判断当前时间是否已经过了2023年11月17号\nimport { getAudit } from '@/services/Audit'\nconst isPastTargetDate = ref<boolean>(false)\nconst getA = async () => {\n  const res = await getAudit()\n  console.log(res)\n  isPastTargetDate.value = res.data\n  console.log(isPastTargetDate.value)\n  // if (!isPastTargetDate.value) {\n  //   uni.showToast({\n  //     title: '意见反馈部分功能尚未实现，敬请期待~',\n  //     icon: 'none',\n  //     duration: 1000\n  //   })\n  // }\n  if (!uni.getStorageSync('token')) {\n    uni.showToast({\n      title: '您未登录！',\n      icon: 'none',\n      duration: 1000,\n    })\n  }\n}\nonLoad(() => {\n  getA()\n})\nonShow(() => {\n  // getA()\n  // console.log(isPastTargetDate.value)\n})\ntype img = {\n  now: string\n  temp: string\n}\ntype postContent = {\n  content: string\n  phone: string\n  picture: string\n  name: string\n  id: string\n}\ntype feedBackContent = {\n  problem: string\n  contact: string\n  img: Array<img>\n  name: string\n}\n\nconst feedBack = ref<feedBackContent>({\n  problem: '',\n  contact: '',\n  img: [],\n  name: '',\n})\n\nconst validatePhone = (phone: string) => {\n  const reg = /^1\\d{10}$/\n  return reg.test(phone)\n}\n\nconst deleteImg = (e: any) => {\n  const index = e.index\n  console.log(e)\n  feedBack.value.img.forEach((item, index) => {\n    if (item.temp === e.tempFilePath) {\n      feedBack.value.img.splice(index, 1)\n    }\n  })\n}\nconst select = (e: any) => {\n  console.log(e)\n  const tempFilePaths = e.tempFilePaths\n  uploadFiles(tempFilePaths, 0)\n}\n\nconst uploadFiles = async (tempFilePaths: any, i: any) => {\n  const res = await uni.uploadFile({\n    url: 'https://www.academictime.cn:3166/system/common/upload',\n    filePath: tempFilePaths[i],\n    header: {\n      Authorization: 'Bearer ' + uni.getStorageSync('token'),\n      'Content-Type': 'multipart/form-data',\n    },\n    name: 'file',\n    success: (res) => {\n      console.log(res)\n      const resData = JSON.parse(res.data)\n      feedBack.value.img.push({ now: resData.msg, temp: tempFilePaths[i] })\n    },\n    fail: () => {\n      console.log('fail')\n      uni.showToast({\n        title: '上传失败',\n        icon: 'none',\n      })\n    },\n  })\n}\n\nconst postFeedback = async (data: postContent) => {\n  const res = await postFeedbackAPI(data)\n  console.log(res)\n  if (res.code == 200) {\n    wx.showToast({\n      title: res.msg,\n      icon: 'success',\n      duration: 2000,\n      complete: function () {\n        setTimeout(function () {\n          uni.switchTab({\n            url: '/pages/my/my',\n          })\n        }, 2000)\n      },\n    })\n  } else if (res.code == 401) {\n    uni.showToast({\n      title: '您未登录！',\n      icon: 'none',\n      duration: 1000,\n    })\n  } else {\n    wx.showToast({\n      title: res.msg,\n      icon: 'none',\n      duration: 2000,\n    })\n  }\n}\n\nconst submit = () => {\n  console.log(feedBack.value)\n  let imgString = feedBack.value.img.map((item) => item.now).join('&')\n  console.log(imgString)\n  if (feedBack.value.problem === '') {\n    uni.showToast({\n      title: '请填写问题描述',\n      icon: 'none',\n    })\n    return\n  } else if (feedBack.value.name === '') {\n    uni.showToast({\n      title: '请填写联系人姓名',\n      icon: 'none',\n    })\n  } else if (feedBack.value.contact === '') {\n    uni.showToast({\n      title: '请填写联系方式',\n      icon: 'none',\n    })\n  } else if (!validatePhone(feedBack.value.contact)) {\n    uni.showToast({\n      title: '请填写正确的联系方式',\n      icon: 'none',\n    })\n  } else {\n    postFeedback({\n      name: feedBack.value.name,\n      phone: feedBack.value.contact,\n      content: feedBack.value.problem,\n      picture: imgString,\n      id: '',\n    })\n  }\n}\n</script>\n<style lang=\"scss\">\n.feedback {\n  // height: 100vh;\n  overflow-y: scroll;\n  width: 90%;\n  margin: 0 auto;\n\n  .feedback-item {\n    width: 100%;\n    height: 100%;\n    background-color: #fff;\n    padding: 20rpx;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n\n    .feedback-content {\n      width: 100%;\n      height: 95%;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-around;\n\n      .feedback-content-item {\n        margin-top: 5%;\n        width: 100%;\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        // margin-bottom: 60rpx;\n\n        .feedback-content-item-title {\n          font-size: 28rpx;\n          font-weight: 600;\n          color: #5d5c5c;\n          margin-bottom: 20rpx;\n        }\n\n        .feedback-content-item-input {\n          width: 100%;\n          height: 100%;\n          display: flex;\n          flex-direction: column;\n          justify-content: space-between;\n\n          textarea {\n            width: 100%;\n            height: 200rpx;\n            border: 1px solid #eee;\n            border-radius: 10rpx;\n            padding: 20rpx;\n            box-sizing: border-box;\n            font-size: 28rpx;\n            color: #5d5c5c;\n            resize: none;\n          }\n\n          .feedback-content-item-input-img {\n            width: 100%;\n            height: 200rpx;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n\n            image {\n              width: 200rpx;\n              height: 200rpx;\n              border: 1px solid #eee;\n              border-radius: 10rpx;\n            }\n          }\n        }\n      }\n    }\n\n    .feedback-btn {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-end;\n      margin-bottom: 30rpx;\n\n      .btn {\n        margin-top: 70rpx;\n        width: 40%;\n        font-size: 35rpx;\n        color: #fff;\n        background-color: #0077b6;\n      }\n    }\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/whhbbb/Documents/Project-storage/xswc_game/src/pages/my/components/feedBack.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getAudit","uni","onLoad","onShow","index","res","postFeedbackAPI","wx"],"mappings":";;;;;;;;;;;;;;;;;;;;AAiEoBA,kBAAA,IAAQ,oBAAA,MAAM;AAO5B,UAAA,mBAAmBA,kBAAa,KAAK;AAC3C,UAAM,OAAO,YAAY;AACjB,YAAA,MAAM,MAAMC,eAAAA;AAClB,cAAQ,IAAI,GAAG;AACf,uBAAiB,QAAQ,IAAI;AACrB,cAAA,IAAI,iBAAiB,KAAK;AAQlC,UAAI,CAACC,cAAA,MAAI,eAAe,OAAO,GAAG;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,QAAA,CACX;AAAA,MACH;AAAA,IAAA;AAEFC,kBAAAA,OAAO,MAAM;AACN;IAAA,CACN;AACDC,kBAAAA,OAAO,MAAM;AAAA,IAAA,CAGZ;AAmBD,UAAM,WAAWJ,cAAAA,IAAqB;AAAA,MACpC,SAAS;AAAA,MACT,SAAS;AAAA,MACT,KAAK,CAAC;AAAA,MACN,MAAM;AAAA,IAAA,CACP;AAEK,UAAA,gBAAgB,CAAC,UAAkB;AACvC,YAAM,MAAM;AACL,aAAA,IAAI,KAAK,KAAK;AAAA,IAAA;AAGjB,UAAA,YAAY,CAAC,MAAW;AACd,QAAE;AAChB,cAAQ,IAAI,CAAC;AACb,eAAS,MAAM,IAAI,QAAQ,CAAC,MAAMK,WAAU;AACtC,YAAA,KAAK,SAAS,EAAE,cAAc;AAChC,mBAAS,MAAM,IAAI,OAAOA,QAAO,CAAC;AAAA,QACpC;AAAA,MAAA,CACD;AAAA,IAAA;AAEG,UAAA,SAAS,CAAC,MAAW;AACzB,cAAQ,IAAI,CAAC;AACb,YAAM,gBAAgB,EAAE;AACxB,kBAAY,eAAe,CAAC;AAAA,IAAA;AAGxB,UAAA,cAAc,OAAO,eAAoB,MAAW;AAC5C,YAAMH,cAAAA,MAAI,WAAW;AAAA,QAC/B,KAAK;AAAA,QACL,UAAU,cAAc,CAAC;AAAA,QACzB,QAAQ;AAAA,UACN,eAAe,YAAYA,oBAAI,eAAe,OAAO;AAAA,UACrD,gBAAgB;AAAA,QAClB;AAAA,QACA,MAAM;AAAA,QACN,SAAS,CAACI,SAAQ;AAChB,kBAAQ,IAAIA,IAAG;AACf,gBAAM,UAAU,KAAK,MAAMA,KAAI,IAAI;AAC1B,mBAAA,MAAM,IAAI,KAAK,EAAE,KAAK,QAAQ,KAAK,MAAM,cAAc,CAAC,EAAG,CAAA;AAAA,QACtE;AAAA,QACA,MAAM,MAAM;AACV,kBAAQ,IAAI,MAAM;AAClBJ,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACP;AAAA,QACH;AAAA,MAAA,CACD;AAAA,IAAA;AAGG,UAAA,eAAe,OAAO,SAAsB;AAC1C,YAAA,MAAM,MAAMK,kCAAgB,IAAI;AACtC,cAAQ,IAAI,GAAG;AACX,UAAA,IAAI,QAAQ,KAAK;AACnBC,sBAAAA,KAAG,UAAU;AAAA,UACX,OAAO,IAAI;AAAA,UACX,MAAM;AAAA,UACN,UAAU;AAAA,UACV,UAAU,WAAY;AACpB,uBAAW,WAAY;AACrBN,4BAAAA,MAAI,UAAU;AAAA,gBACZ,KAAK;AAAA,cAAA,CACN;AAAA,eACA,GAAI;AAAA,UACT;AAAA,QAAA,CACD;AAAA,MAAA,WACQ,IAAI,QAAQ,KAAK;AAC1BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,QAAA,CACX;AAAA,MAAA,OACI;AACLM,sBAAAA,KAAG,UAAU;AAAA,UACX,OAAO,IAAI;AAAA,UACX,MAAM;AAAA,UACN,UAAU;AAAA,QAAA,CACX;AAAA,MACH;AAAA,IAAA;AAGF,UAAM,SAAS,MAAM;AACX,cAAA,IAAI,SAAS,KAAK;AACtB,UAAA,YAAY,SAAS,MAAM,IAAI,IAAI,CAAC,SAAS,KAAK,GAAG,EAAE,KAAK,GAAG;AACnE,cAAQ,IAAI,SAAS;AACjB,UAAA,SAAS,MAAM,YAAY,IAAI;AACjCN,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACD;AAAA,MACS,WAAA,SAAS,MAAM,SAAS,IAAI;AACrCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AAAA,MACQ,WAAA,SAAS,MAAM,YAAY,IAAI;AACxCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AAAA,iBACQ,CAAC,cAAc,SAAS,MAAM,OAAO,GAAG;AACjDA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AAAA,MAAA,OACI;AACQ,qBAAA;AAAA,UACX,MAAM,SAAS,MAAM;AAAA,UACrB,OAAO,SAAS,MAAM;AAAA,UACtB,SAAS,SAAS,MAAM;AAAA,UACxB,SAAS;AAAA,UACT,IAAI;AAAA,QAAA,CACL;AAAA,MACH;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxOF,GAAG,WAAW,eAAe;"}