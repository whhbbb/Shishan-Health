{"version":3,"file":"editUser.js","sources":["../../../../../../src/pages/my/components/editUser.vue","../../../../../../uniPage:/cGFnZXMvbXkvY29tcG9uZW50cy9lZGl0VXNlci52dWU"],"sourcesContent":["<template>\r\n  <view v-if=\"isPastTargetDate\" class=\"user\">\r\n    <navigator class=\"avatar item\" :url=\"`/pages/my/components/userImage?userAvatar=${user.img}`\">\r\n      <view>头像</view>\r\n      <view class=\"user-avatar texts\">\r\n        <image class=\"img\" :src=\"user.img\" />\r\n        <image src=\"../../../static/my/arrow-right.png\" />\r\n      </view>\r\n    </navigator>\r\n    <view class=\"item\">\r\n      <view>名字</view>\r\n      <view class=\"texts\">\r\n        <text class=\"text1\">{{ user.name }}</text>\r\n      </view>\r\n    </view>\r\n    <view class=\"item\">\r\n      <view>学院</view>\r\n      <view class=\"texts\">\r\n        <text class=\"text1\">{{ user.college }}</text>\r\n      </view>\r\n    </view>\r\n    <view class=\"item\">\r\n      <view>学号</view>\r\n      <view class=\"texts\">\r\n        <text class=\"text1\">{{ user.studentId }}</text>\r\n      </view>\r\n    </view>\r\n    <view class=\"item\">\r\n      <view>用户名</view>\r\n      <view class=\"texts\">\r\n        <text class=\"text1\" v-if=\"!isDisabled\">{{ user.nickName }}</text>\r\n        <uni-easyinput class=\"text2\" v-else v-model=\"editedUser.nickName\" />\r\n      </view>\r\n    </view>\r\n    <view class=\"item\">\r\n      <view>电话</view>\r\n      <view class=\"texts\">\r\n        <text class=\"text1\" v-if=\"!isDisabled\">{{ user.phonenumber }}</text>\r\n\r\n        <uni-easyinput v-else class=\"text2\" v-model=\"editedUser.phonenumber\" />\r\n      </view>\r\n    </view>\r\n    <view class=\"btns\">\r\n      <button @tap=\"changeUserInfo\" v-if=\"!isDisabled\">修改个人资料</button>\r\n      <view v-if=\"isDisabled\">\r\n        <button @tap=\"saveEdit\">保存</button>\r\n        <button @tap=\"cancelEdit\">取消修改</button>\r\n      </view>\r\n      <button @click=\"editPassword\">修改密码</button>\r\n      <button @tap=\"logout\">退出登录</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive } from 'vue'\r\nimport { onLoad, onShow } from '@dcloudio/uni-app'\r\nimport { getPersonalInf, changePersonalInf } from '@/services/personalInf'\r\n// type userInfo = {\r\n//   name: string\r\n//   studentId: string\r\n//   img?: string\r\n//   // 学院\r\n//   college: string\r\n// }\r\nimport { getAudit } from '@/services/Audit'\r\nconst isPastTargetDate = ref<boolean>(false)\r\nconst getA = async () => {\r\n  const res = await getAudit()\r\n  console.log(res)\r\n  isPastTargetDate.value = res.data\r\n}\r\nconst isDisabled = ref<Boolean>(false)\r\nconst user = ref<any>({})\r\n\r\nconst editedUser = ref<any>({})\r\n\r\nconst colleges = ref<any>([])\r\nconst getPersonal = async () => {\r\n  const res = await getPersonalInf()\r\n  console.log(res)\r\n  user.value.name = res.data.name\r\n  // user.value.img=res.data.img\r\n  user.value.college = res.data.dept.deptName\r\n  user.value.studentId = res.data.userName\r\n  user.value.nickName = res.data.nickName\r\n  user.value.phonenumber = res.data.phonenumber\r\n  user.value.img = res.data.avatar === '' ? '../../../static/my/headpic.png' : res.data.avatar\r\n  editedUser.value = res.data\r\n}\r\nonLoad(() => {\r\n  getA()\r\n})\r\nonShow(() => {\r\n  getA()\r\n  getPersonal()\r\n})\r\n\r\nconst changeUserInfo = () => {\r\n  getPersonal()\r\n  isDisabled.value = !isDisabled.value\r\n}\r\n\r\nconst saveEdit = () => {\r\n  if (!/^1[3456789]\\d{9}$/.test(editedUser.value.phonenumber)) {\r\n    uni.showToast({\r\n      title: '请输入正确的手机号',\r\n      icon: 'none',\r\n    })\r\n    return false\r\n  }\r\n  if (editedUser.value.nickName && editedUser.value.phonenumber) {\r\n    console.log(editedUser.value)\r\n    changePersonalInf(editedUser.value).then((res) => {\r\n      console.log(res)\r\n      if (res.code == 500) {\r\n        uni.showToast({\r\n          title: '违规操作！',\r\n          icon: 'none',\r\n        })\r\n        return false\r\n      }\r\n      getPersonal()\r\n    })\r\n    isDisabled.value = !isDisabled.value\r\n  } else {\r\n    uni.showToast({\r\n      title: '请填写完整信息',\r\n      icon: 'none',\r\n    })\r\n  }\r\n}\r\n\r\nconst cancelEdit = () => {\r\n  isDisabled.value = !isDisabled.value\r\n}\r\n\r\nconst logout = () => {\r\n  uni.showModal({\r\n    title: '提示',\r\n    content: '确定退出登录吗？',\r\n    success: (res) => {\r\n      if (res.confirm) {\r\n        // 清除token\r\n        uni.removeStorageSync('token')\r\n        uni.showToast({\r\n          title: '退出成功',\r\n          icon: 'success',\r\n          duration: 2000,\r\n        })\r\n        setTimeout(() => {\r\n          uni.reLaunch({\r\n            url: '/pages/login/login',\r\n          })\r\n        }, 2000)\r\n      } else if (res.cancel) {\r\n        console.log('用户点击取消')\r\n      }\r\n    },\r\n  })\r\n}\r\nconst editPassword = () => {\r\n  uni.navigateTo({\r\n    url: '/pages/my/components/editPassword',\r\n  })\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n.user {\r\n  width: 90%;\r\n  margin: 0 auto;\r\n\r\n  .item {\r\n    display: flex;\r\n    width: 100%;\r\n    height: 130rpx;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    border-bottom: 1px solid #e5e3e3;\r\n\r\n    .texts {\r\n      max-width: 65%;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      flex-wrap: nowrap;\r\n      align-items: center;\r\n\r\n      .text1 {\r\n        margin-right: 5rpx;\r\n        color: #8e8d8d;\r\n      }\r\n\r\n      image {\r\n        width: 40rpx;\r\n        height: 40rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .avatar {\r\n    height: 200rpx;\r\n\r\n    .user-avatar {\r\n      .img {\r\n        width: 80rpx;\r\n        height: 80rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .btns {\r\n    border-bottom: none;\r\n    display: flex;\r\n    flex-direction: column;\r\n    button {\r\n      margin-top: 20rpx;\r\n      width: 100%;\r\n      background-color: #eeeded;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/feidian/计算机设计大赛/xswc_cs/src/pages/my/components/editUser.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getAudit","getPersonalInf","onLoad","onShow","uni","changePersonalInf"],"mappings":";;;;;;;;;;;;;;;;;;AAkEM,UAAA,mBAAmBA,kBAAa,KAAK;AAC3C,UAAM,OAAO,YAAY;AACjB,YAAA,MAAM,MAAMC,eAAAA;AAClB,cAAQ,IAAI,GAAG;AACf,uBAAiB,QAAQ,IAAI;AAAA,IAAA;AAEzB,UAAA,aAAaD,kBAAa,KAAK;AAC/B,UAAA,OAAOA,kBAAS,CAAA,CAAE;AAElB,UAAA,aAAaA,kBAAS,CAAA,CAAE;AAEbA,kBAAAA,IAAS,CAAA,CAAE;AAC5B,UAAM,cAAc,YAAY;AACxB,YAAA,MAAM,MAAME,qBAAAA;AAClB,cAAQ,IAAI,GAAG;AACV,WAAA,MAAM,OAAO,IAAI,KAAK;AAE3B,WAAK,MAAM,UAAU,IAAI,KAAK,KAAK;AAC9B,WAAA,MAAM,YAAY,IAAI,KAAK;AAC3B,WAAA,MAAM,WAAW,IAAI,KAAK;AAC1B,WAAA,MAAM,cAAc,IAAI,KAAK;AAC7B,WAAA,MAAM,MAAM,IAAI,KAAK,WAAW,KAAK,mCAAmC,IAAI,KAAK;AACtF,iBAAW,QAAQ,IAAI;AAAA,IAAA;AAEzBC,kBAAAA,OAAO,MAAM;AACN;IAAA,CACN;AACDC,kBAAAA,OAAO,MAAM;AACN;AACO;IAAA,CACb;AAED,UAAM,iBAAiB,MAAM;AACf;AACD,iBAAA,QAAQ,CAAC,WAAW;AAAA,IAAA;AAGjC,UAAM,WAAW,MAAM;AACrB,UAAI,CAAC,oBAAoB,KAAK,WAAW,MAAM,WAAW,GAAG;AAC3DC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACM,eAAA;AAAA,MACT;AACA,UAAI,WAAW,MAAM,YAAY,WAAW,MAAM,aAAa;AACrD,gBAAA,IAAI,WAAW,KAAK;AAC5BC,6BAAAA,kBAAkB,WAAW,KAAK,EAAE,KAAK,CAAC,QAAQ;AAChD,kBAAQ,IAAI,GAAG;AACX,cAAA,IAAI,QAAQ,KAAK;AACnBD,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,YAAA,CACP;AACM,mBAAA;AAAA,UACT;AACY;QAAA,CACb;AACU,mBAAA,QAAQ,CAAC,WAAW;AAAA,MAAA,OAC1B;AACLA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AAAA,MACH;AAAA,IAAA;AAGF,UAAM,aAAa,MAAM;AACZ,iBAAA,QAAQ,CAAC,WAAW;AAAA,IAAA;AAGjC,UAAM,SAAS,MAAM;AACnBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AAEfA,gCAAI,kBAAkB,OAAO;AAC7BA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,cACN,UAAU;AAAA,YAAA,CACX;AACD,uBAAW,MAAM;AACfA,4BAAAA,MAAI,SAAS;AAAA,gBACX,KAAK;AAAA,cAAA,CACN;AAAA,eACA,GAAI;AAAA,UAAA,WACE,IAAI,QAAQ;AACrB,oBAAQ,IAAI,QAAQ;AAAA,UACtB;AAAA,QACF;AAAA,MAAA,CACD;AAAA,IAAA;AAEH,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MAAA,CACN;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnKH,GAAG,WAAW,eAAe;"}