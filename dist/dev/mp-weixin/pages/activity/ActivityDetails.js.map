{"version":3,"file":"ActivityDetails.js","sources":["../../../../../src/pages/activity/ActivityDetails.vue","../../../../../uniPage:/cGFnZXMvYWN0aXZpdHkvQWN0aXZpdHlEZXRhaWxzLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"detail\">\n      <view class=\"img-wrapper\">\n        <image class=\"img\" :src=\"data0.lng\" />\n      </view>\n      <view class=\"top\">\n        <view class=\"detail-title\">\n          {{ data0.userImg2 }}\n        </view>\n        <!-- <view class=\"detail-content\">\n        <view class=\"status\">\n          {{ data0.isEnd }}\n        </view>\n        <view class=\"population\">\n          <image class=\"img\" src=\"../../static/activity/User.png\" />{{ data0.hbNum }}/{{\n            data0.hot\n          }}\n        </view>\n        <view class=\"detail-class\">\n          <uni-tag v-if=\"data0.sort == 1\" type=\"primary\" text=\"学术晚茶\" />\n          <uni-tag v-else type=\"success\" text=\"学术社区\" />\n        </view>\n      </view> -->\n      </view>\n      <view class=\"middle\">\n        <view class=\"sponsor\">\n          <image class=\"img\" src=\"../../static/activity/loco.png\" />\n          {{ data0.hbKeyword }}\n        </view>\n        <view class=\"time\">\n          <image class=\"img\" src=\"../../static/bottomBar/sign-in-black.png\" />{{ data0.lat }}\n        </view>\n        <!-- <view class=\"address\">\n        <image class=\"img\" src=\"../../static/activity/address.png\" />{{ data0.address }}\n      </view>\n      <view class=\"address\">\n        <image class=\"img\" src=\"../../static/activity/address.png\" />线上地址：{{\n          data0.cityname == '' ? '无' : data0.cityname\n        }}\n      </view> -->\n      </view>\n      <view class=\"bottom\">\n        <view class=\"sponsor-intro\">\n          <view class=\"title\"> 主讲人简介： </view>\n          <view class=\"intro\">\n            {{ data0.img }}\n          </view>\n        </view>\n        <view class=\"activity-intro\">\n          <view class=\"title\"> 活动简介： </view>\n          <view class=\"intro\">\n            {{ data0.details }}\n          </view>\n        </view>\n      </view>\n    </view>\n    <view class=\"footer\">\n      <view class=\"footer-inner\">\n        <view class=\"footer-info\">\n          <view>\n            {{ data0.hbNum }}/{{ data0.hot }}\n          </view>\n          <view v-if=\"data0.isClose == 2\">还有0天截止</view>\n          <view v-else-if=\"data0.isClose == 1\" class=\"start\">\n            <view>报名截止倒计时：</view>\n            <view>{{ countDown }}</view>\n          </view>\n          <view v-else-if=\"data0.isClose == 0\" class=\"start\">\n            <view>报名开始时间为：</view>\n            <view>{{ data0.startTime }}</view>\n          </view>\n        </view>\n        <view class=\"activity-btn\">\n          <button class=\"btn\" v-if=\"data0.isClose === 0\" type=\"default\">报名未开始</button>\n          <button type=\"default\" v-else-if=\"data0.isApplication.length === 0 && data0.isClose === 1\" class=\"btn\"\n            @click=\"applyon\">\n            报名\n          </button>\n          <button type=\"default\" v-else-if=\"data0.isApplication.length > 0 && data0.isClose === 1\" class=\"btn-active\">\n            已报名\n          </button>\n          <button type=\"default\" v-else-if=\"data0.isClose == 2\" class=\"btn\">报名截止</button>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport { http } from '../../utils/http'\nimport { ref, reactive } from 'vue'\nimport { onHide, onLoad } from '@dcloudio/uni-app'\ntype DataProps = {\n  id: number\n  userImg2: string\n  isEnd: string\n  isClose: number\n  hbNum: number\n  hot: number\n  hbKeyword: string\n  lat: string\n  address: string\n  img: string\n  details: string\n  isApplication: Array<any>\n  is_close: number\n  startTime: string\n  sort: number\n  cityname: string\n  lng: string\n}\n\nconst countDown = ref<string>()\nconst data0 = ref<DataProps>()\nconst props = defineProps<{\n  id: number\n}>()\nlet AId = props.id;\nconst getDetailsAPI = (data: any) => {\n  return http<any>({\n    url: data,\n    method: 'GET',\n  })\n}\nconst applyAPI = (data: any) => {\n  return http<any>({\n    method: 'POST',\n    url: '/system/useractivity',\n    data,\n  })\n}\nconst getDetails = async (url: string) => {\n  uni.showLoading({\n    title: '加载中',\n  })\n  const res = await getDetailsAPI(url)\n  uni.hideLoading()\n  console.log(res)\n  data0.value = res.data\n  data0.value.isEnd = res.data.isEnd == 1 ? '进行中' : '已结束'\n  data0.value.isApplication = res.data.isApplication === null ? [] : res.data.isApplication\n}\nconst apply = async (data: any) => {\n  const res = await applyAPI(data)\n  if (res.code === 200) {\n    wx.showToast({\n      title: res.msg,\n      icon: 'success',\n      duration: 2000,\n      success: () => {\n        setTimeout(() => {\n          uni.switchTab({\n            url: '/pages/index/index',\n          })\n        }, 2000)\n      },\n    })\n    data0.value.is_close = 1\n  } else {\n    wx.showToast({\n      title: res.msg,\n      icon: 'none',\n      duration: 2000,\n    })\n  }\n}\n\nfunction parseDateForIOS(dateString) {\n  // 将日期字符串中的连字符(-)替换为斜杠(/)\n  dateString = dateString.replace(/-/g, '/');\n\n  // 如果日期字符串包含时间部分，则将时间部分以空格分隔，并移除秒和时区信息\n  if (dateString.includes(' ')) {\n    const [datePart, timePart] = dateString.split(' ');\n    dateString = `${datePart} ${timePart.split(':')[0]}:${timePart.split(':')[1]}`;\n  }\n\n  return new Date(dateString);\n}\n\n// 写一个实时倒计时\nconst countTime = () => {\n  let now = new Date().getTime()\n  let endTime = parseDateForIOS(data0.value.lat).getTime()-2*60*60*1000\n  // endTime前两个小时\n  let time = endTime - now\n  let day = Math.floor(time / (24 * 3600 * 1000))\n  let hour = Math.floor((time % (24 * 3600 * 1000)) / (3600 * 1000))\n  let minute = Math.floor((time % (3600 * 1000)) / (60 * 1000))\n  let second = Math.floor((time % (60 * 1000)) / 1000)\n  return `${day}天${hour}时${minute}分${second}秒`\n}\n\nonLoad(async (options) => {\n  let obj = wx.getLaunchOptionsSync()\n  let query = null\n  let url = `/system/activity/${props.id}`\n  console.log(props.id + \"11111\")\n  if (options.scene || obj.query.scene) {\n    console.log('options.scene', options)\n    console.log('obj.query.scene', obj.query)\n    // 这里是用开发者工具模拟的时候要先用 encodeURIComponent 编译，模拟真实传递参数的效果，项目发布审核的时候这句话要注释掉\n    // query = options ? encodeURIComponent(options.scene) : encodeURIComponent(obj.query.scene);\n    query = options ? decodeURIComponent(options.scene) : decodeURIComponent(obj.query.scene)\n    console.log(query)\n    AId = query;\n    url = `/system/activity/${query}`\n  }\n  await getDetails(url)\n  countDown.value=countTime()\n  setInterval(() => {\n    countDown.value=countTime()\n  }, 1000)\n})\nonHide(() => { })\n//报名函数\nconst applyon = () => {\n  if (uni.getStorageSync('token')) {\n    wx.showModal({\n      title: '确认报名',\n      content: '确定要报名吗？',\n      success(res) {\n        if (res.confirm) {\n          //用户点击了确认按钮\n          apply({\n            activityId: AId,\n          })\n          const url = `/system/activity/${AId}`\n          getDetails(url)\n        } else if (res.cancel) {\n          // 用户点击了取消按钮\n          console.log('用户取消了报名')\n        }\n      },\n    })\n  } else {\n    wx.showToast({\n      title: '您尚未登录，请先登录',\n      icon: 'none',\n      duration: 1000,\n      complete: () => {\n        setTimeout(() => {\n          uni.navigateTo({\n            url: '/pages/login/login',\n          })\n        }, 1000)\n      },\n    })\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.container {\n  display: flex;\n  flex-direction: column;\n}\n\n.detail {\n  // overflow-y: scroll;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  width: 82%;\n  margin: 0 auto;\n  flex: 1;\n  padding-bottom: 174rpx;\n  overflow: hidden;\n\n  .img-wrapper {\n    margin-top: 20rpx;\n    width: 100%;\n    height: 70vh;\n    background-color: #6b6a6a;\n    border-radius: 15rpx;\n\n    .img {\n      width: 100%;\n      height: 100%;\n      border-radius: 15rpx;\n    }\n  }\n\n  .top {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    margin-top: 35rpx;\n    margin-bottom: 15rpx;\n\n    .detail-title {\n      font-size: 38rpx;\n      // font-weight: bold;\n    }\n\n    .detail-content {\n      display: flex;\n      justify-content: space-between;\n      margin: 0 10rpx 10rpx 10rpx;\n\n      .status {\n        font-size: 30rpx;\n        color: #ff0000;\n\n        .img {\n          width: 30rpx;\n          height: 30rpx;\n          margin-right: 10rpx;\n        }\n      }\n\n      .population {\n        font-size: 30rpx;\n        color: #000000;\n\n        .img {\n          width: 30rpx;\n          height: 30rpx;\n          margin-right: 10rpx;\n        }\n      }\n    }\n  }\n\n  .middle {\n    height: 140rpx;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-around;\n    margin-bottom: 60rpx;\n\n    .sponsor {\n      flex: 1;\n      display: flex;\n      align-items: center;\n      font-size: 30rpx;\n      color: #000000;\n\n      .img {\n        width: 30rpx;\n        height: 30rpx;\n        margin-right: 10rpx;\n      }\n    }\n\n    .time {\n      font-size: 30rpx;\n      color: #000000;\n      flex: 1;\n      display: flex;\n      align-items: center;\n\n      .img {\n        width: 30rpx;\n        height: 30rpx;\n        margin-right: 10rpx;\n      }\n    }\n\n    .address {\n      font-size: 30rpx;\n      color: #000000;\n      flex: 1;\n      display: flex;\n      align-items: center;\n      border-bottom: 1px solid #d6d6d6;\n\n      .img {\n        width: 30rpx;\n        height: 30rpx;\n        margin-right: 10rpx;\n      }\n    }\n  }\n\n  .bottom {\n    flex: 1;\n\n    .sponsor-intro {\n      margin-bottom: 80rpx;\n\n      .title {\n        font-size: 30rpx;\n        color: grey;\n        margin-bottom: 10rpx;\n      }\n\n      .intro {\n        font-size: 30rpx;\n        color: #000000;\n      }\n    }\n\n    .activity-intro {\n      .title {\n        font-size: 30rpx;\n        color: grey;\n        margin-bottom: 10rpx;\n      }\n\n      .intro {\n        font-size: 30rpx;\n        color: #000000;\n      }\n    }\n  }\n\n\n}\n\n.footer {\n  height: 150rpx;\n  color: #0077B6;\n  font-size: 26rpx;\n  padding: 30rpx 0 30rpx 0;\n  justify-content: space-evenly;\n  position: fixed;\n  bottom: 0;\n  box-shadow: 0px -0.5px 0.5rpx #E7E8E9;\n  background-color: #F5F6F7;\n  width: 100%;\n\n  .footer-inner {\n    margin: 0 auto;\n    width: 82%;\n    display: flex;\n    justify-content: space-between;\n    .footer-info{\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      width: 40%;\n      .start{\n        font-size: 20rpx;\n      }\n    }\n    .activity-btn {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100%;\n      width: 60%;\n\n      .btn {\n        width: 100%;\n        height: 90rpx;\n        color: #0077B6;\n        border-radius: 40rpx;\n        background-color: hsl(194, 84%, 51%, 15%);\n        font-size: 35rpx;\n        font-weight: bold;\n      }\n      .btn-active{\n        width: 100%;\n        height: 90rpx;\n        color: #666666;\n        border-radius: 40rpx;\n        background-color: #d9d9d9;\n        font-size: 35rpx;\n        font-weight: bold;\n      }\n    }\n  }\n}\n\n.code-view {\n  margin: 20rpx auto;\n  padding-bottom: 30rpx;\n}\n</style>\n","import MiniProgramPage from '/Users/whhbbb/Documents/Project-storage/xswc_game/src/pages/activity/ActivityDetails.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","http","uni","wx","onLoad","onHide"],"mappings":";;;;;;;;;;;;AAiHA,UAAM,YAAYA,cAAAA;AAClB,UAAM,QAAQA,cAAAA;AAId,QAAI,MAAM,MAAM;AACV,UAAA,gBAAgB,CAAC,SAAc;AACnC,aAAOC,gBAAU;AAAA,QACf,KAAK;AAAA,QACL,QAAQ;AAAA,MAAA,CACT;AAAA,IAAA;AAEG,UAAA,WAAW,CAAC,SAAc;AAC9B,aAAOA,gBAAU;AAAA,QACf,QAAQ;AAAA,QACR,KAAK;AAAA,QACL;AAAA,MAAA,CACD;AAAA,IAAA;AAEG,UAAA,aAAa,OAAO,QAAgB;AACxCC,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,MAAA,CACR;AACK,YAAA,MAAM,MAAM,cAAc,GAAG;AACnCA,oBAAA,MAAI,YAAY;AAChB,cAAQ,IAAI,GAAG;AACf,YAAM,QAAQ,IAAI;AAClB,YAAM,MAAM,QAAQ,IAAI,KAAK,SAAS,IAAI,QAAQ;AAC5C,YAAA,MAAM,gBAAgB,IAAI,KAAK,kBAAkB,OAAO,CAAK,IAAA,IAAI,KAAK;AAAA,IAAA;AAExE,UAAA,QAAQ,OAAO,SAAc;AAC3B,YAAA,MAAM,MAAM,SAAS,IAAI;AAC3B,UAAA,IAAI,SAAS,KAAK;AACpBC,sBAAAA,KAAG,UAAU;AAAA,UACX,OAAO,IAAI;AAAA,UACX,MAAM;AAAA,UACN,UAAU;AAAA,UACV,SAAS,MAAM;AACb,uBAAW,MAAM;AACfD,4BAAAA,MAAI,UAAU;AAAA,gBACZ,KAAK;AAAA,cAAA,CACN;AAAA,eACA,GAAI;AAAA,UACT;AAAA,QAAA,CACD;AACD,cAAM,MAAM,WAAW;AAAA,MAAA,OAClB;AACLC,sBAAAA,KAAG,UAAU;AAAA,UACX,OAAO,IAAI;AAAA,UACX,MAAM;AAAA,UACN,UAAU;AAAA,QAAA,CACX;AAAA,MACH;AAAA,IAAA;AAGF,aAAS,gBAAgB,YAAY;AAEtB,mBAAA,WAAW,QAAQ,MAAM,GAAG;AAGrC,UAAA,WAAW,SAAS,GAAG,GAAG;AAC5B,cAAM,CAAC,UAAU,QAAQ,IAAI,WAAW,MAAM,GAAG;AACjD,qBAAa,GAAG,QAAQ,IAAI,SAAS,MAAM,GAAG,EAAE,CAAC,CAAC,IAAI,SAAS,MAAM,GAAG,EAAE,CAAC,CAAC;AAAA,MAC9E;AAEO,aAAA,IAAI,KAAK,UAAU;AAAA,IAC5B;AAGA,UAAM,YAAY,MAAM;AACtB,UAAI,OAAM,oBAAI,KAAK,GAAE,QAAQ;AACzB,UAAA,UAAU,gBAAgB,MAAM,MAAM,GAAG,EAAE,QAAQ,IAAE,IAAE,KAAG,KAAG;AAEjE,UAAI,OAAO,UAAU;AACrB,UAAI,MAAM,KAAK,MAAM,QAAQ,KAAK,OAAO,IAAK;AAC1C,UAAA,OAAO,KAAK,MAAO,QAAQ,KAAK,OAAO,QAAU,OAAO,IAAK;AACjE,UAAI,SAAS,KAAK,MAAO,QAAQ,OAAO,QAAU,KAAK,IAAK;AAC5D,UAAI,SAAS,KAAK,MAAO,QAAQ,KAAK,OAAS,GAAI;AACnD,aAAO,GAAG,GAAG,IAAI,IAAI,IAAI,MAAM,IAAI,MAAM;AAAA,IAAA;AAG3CC,kBAAA,OAAO,OAAO,YAAY;AACpB,UAAA,MAAMD,mBAAG;AACb,UAAI,QAAQ;AACR,UAAA,MAAM,oBAAoB,MAAM,EAAE;AAC9B,cAAA,IAAI,MAAM,KAAK,OAAO;AAC9B,UAAI,QAAQ,SAAS,IAAI,MAAM,OAAO;AAC5B,gBAAA,IAAI,iBAAiB,OAAO;AAC5B,gBAAA,IAAI,mBAAmB,IAAI,KAAK;AAGhC,gBAAA,UAAU,mBAAmB,QAAQ,KAAK,IAAI,mBAAmB,IAAI,MAAM,KAAK;AACxF,gBAAQ,IAAI,KAAK;AACX,cAAA;AACN,cAAM,oBAAoB,KAAK;AAAA,MACjC;AACA,YAAM,WAAW,GAAG;AACpB,gBAAU,QAAM;AAChB,kBAAY,MAAM;AAChB,kBAAU,QAAM;SACf,GAAI;AAAA,IAAA,CACR;AACDE,kBAAAA,OAAO,MAAM;AAAA,IAAA,CAAG;AAEhB,UAAM,UAAU,MAAM;AAChB,UAAAH,cAAA,MAAI,eAAe,OAAO,GAAG;AAC/BC,sBAAAA,KAAG,UAAU;AAAA,UACX,OAAO;AAAA,UACP,SAAS;AAAA,UACT,QAAQ,KAAK;AACX,gBAAI,IAAI,SAAS;AAET,oBAAA;AAAA,gBACJ,YAAY;AAAA,cAAA,CACb;AACK,oBAAA,MAAM,oBAAoB,GAAG;AACnC,yBAAW,GAAG;AAAA,YAAA,WACL,IAAI,QAAQ;AAErB,sBAAQ,IAAI,SAAS;AAAA,YACvB;AAAA,UACF;AAAA,QAAA,CACD;AAAA,MAAA,OACI;AACLA,sBAAAA,KAAG,UAAU;AAAA,UACX,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,UACV,UAAU,MAAM;AACd,uBAAW,MAAM;AACfD,4BAAAA,MAAI,WAAW;AAAA,gBACb,KAAK;AAAA,cAAA,CACN;AAAA,eACA,GAAI;AAAA,UACT;AAAA,QAAA,CACD;AAAA,MACH;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxPF,GAAG,WAAW,eAAe;"}