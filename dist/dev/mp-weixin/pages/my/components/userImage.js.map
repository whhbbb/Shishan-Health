{"version":3,"file":"userImage.js","sources":["../../../../../../src/pages/my/components/userImage.vue","../../../../../../uniPage:/cGFnZXMvbXkvY29tcG9uZW50cy91c2VySW1hZ2UudnVl"],"sourcesContent":["<template>\r\n  <view class=\"userImage\">\r\n    <view class=\"img\" @tap=\"doImg\">\r\n      <image :src=\"avatar\" />\r\n    </view>\r\n  </view>\r\n  <uni-popup ref=\"popup\">\r\n    <view class=\"pop\">\r\n      <view class=\"btns\">\r\n        <!-- <button @click=\"takePhoto\">拍照</button> -->\r\n        <button @click=\"chooseImage\">从相册选择</button>\r\n        <button @click=\"saveImage\">保存图片</button>\r\n      </view>\r\n      <button class=\"btn\" @tap=\"cancel\">取消</button>\r\n    </view>\r\n  </uni-popup>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive } from 'vue'\r\nimport { changePersonalInf } from '@/services/personalInf'\r\nconst popup = ref<{\r\n  open: (type?: UniHelper.UniPopupType) => void\r\n  close: () => void\r\n}>()\r\nconst props = defineProps<{\r\n  userAvatar: string\r\n}>()\r\n\r\nconst avatar = ref<string>(props.userAvatar)\r\n\r\nconst editUserImg = async (imgUrl: string) => {\r\n  const res = await changePersonalInf({\r\n    // userName: props.userName,\r\n    avatar: imgUrl,\r\n  })\r\n  console.log(res)\r\n  if (res.code === 200) {\r\n    uni.showToast({\r\n      title: '修改成功',\r\n      icon: 'none',\r\n    })\r\n    avatar.value = imgUrl\r\n  } else {\r\n    uni.showToast({\r\n      title: '修改失败',\r\n      icon: 'none',\r\n    })\r\n  }\r\n}\r\nconst doImg = () => {\r\n  console.log('点击了图片')\r\n  if (popup.value) {\r\n    popup.value.open('bottom')\r\n  }\r\n}\r\n// const takePhoto = () => {\r\n//   console.log('拍照')\r\n//   popup.value?.close()\r\n//   uni.chooseImage({\r\n//     count: 1,\r\n//     sourceType: ['camera'],\r\n//     success: (success) => {\r\n//       console.log(success)\r\n//     },\r\n//     fail: (err) => {\r\n//       console.log(err)\r\n//     },\r\n//     complete: (complete) => {\r\n//       console.log(complete)\r\n//     },\r\n//   })\r\n// }\r\nconst chooseImage = () => {\r\n  console.log('从相册选择')\r\n  popup.value?.close()\r\n  uni.chooseImage({\r\n    count: 1,\r\n    sourceType: ['album'],\r\n    success: (success) => {\r\n      uni.uploadFile({\r\n        url: 'https://www.academictime.cn:3166/system/common/upload',\r\n        filePath: success.tempFilePaths[0],\r\n        header: {\r\n          Authorization: 'Bearer ' + uni.getStorageSync('token'),\r\n          'Content-Type': 'multipart/form-data',\r\n        },\r\n        name: 'file',\r\n        success: (success) => {\r\n          console.log(success)\r\n          const resData = JSON.parse(success.data)\r\n          console.log(resData)\r\n          editUserImg(resData.msg)\r\n        },\r\n      })\r\n    },\r\n    fail: (err) => {\r\n      console.log(err)\r\n      uni.showToast({\r\n        title: '上传失败',\r\n        icon: 'none',\r\n      })\r\n    },\r\n    complete: (complete) => {\r\n      console.log(complete)\r\n    },\r\n  })\r\n}\r\nconst saveImage = () => {\r\n  popup.value?.close()\r\n  uni.downloadFile({\r\n    url:avatar.value,\r\n    success:(res)=>{\r\n      if(res.statusCode===200){\r\n        uni.saveImageToPhotosAlbum({\r\n          filePath: res.tempFilePath,\r\n          success: (success) => {\r\n            console.log(success)\r\n          },\r\n          fail: (err) => {\r\n            console.log(err)\r\n          },\r\n          complete: (complete) => {\r\n            console.log(complete)\r\n          },\r\n        })\r\n      }else{\r\n        uni.showToast({\r\n          title:'保存失败',\r\n          icon:'none'\r\n        })\r\n      }\r\n    },\r\n    fail:(fail)=>{\r\n      console.log('下载失败',fail);\r\n    },\r\n})\r\n}\r\n\r\nconst cancel = () => {\r\n  console.log('取消')\r\n  popup.value?.close()\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n.userImage {\r\n  background-color: #000;\r\n  height: 100vh;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n\r\n  .img {\r\n    height: 700rpx;\r\n    width: 700rpx;\r\n  }\r\n}\r\n\r\n.pop {\r\n  display: flex;\r\n  flex-direction: column;\r\n  background-color: white;\r\n  border-radius: 20rpx;\r\n\r\n  .btns {\r\n    height: 250rpx;\r\n    width: 100%;\r\n    text-align: center;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-around;\r\n\r\n    button {\r\n      flex: 1;\r\n      width: 100%;\r\n      box-sizing: border-box;\r\n      border-bottom: 1px solid #e5e3e3;\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n    }\r\n  }\r\n\r\n  .btn {\r\n    width: 100%;\r\n    border-top: 5px solid #e5e3e3;\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/feidian/计算机设计大赛/xswc_cs/src/pages/my/components/userImage.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","changePersonalInf","uni","success"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA,UAAM,QAAQA,cAAAA;AAQR,UAAA,SAASA,cAAAA,IAAY,MAAM,UAAU;AAErC,UAAA,cAAc,OAAO,WAAmB;AACtC,YAAA,MAAM,MAAMC,uCAAkB;AAAA;AAAA,QAElC,QAAQ;AAAA,MAAA,CACT;AACD,cAAQ,IAAI,GAAG;AACX,UAAA,IAAI,SAAS,KAAK;AACpBC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACD,eAAO,QAAQ;AAAA,MAAA,OACV;AACLA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AAAA,MACH;AAAA,IAAA;AAEF,UAAM,QAAQ,MAAM;AAClB,cAAQ,IAAI,OAAO;AACnB,UAAI,MAAM,OAAO;AACT,cAAA,MAAM,KAAK,QAAQ;AAAA,MAC3B;AAAA,IAAA;AAmBF,UAAM,cAAc,MAAM;;AACxB,cAAQ,IAAI,OAAO;AACnB,kBAAM,UAAN,mBAAa;AACbA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,YAAY,CAAC,OAAO;AAAA,QACpB,SAAS,CAAC,YAAY;AACpBA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK;AAAA,YACL,UAAU,QAAQ,cAAc,CAAC;AAAA,YACjC,QAAQ;AAAA,cACN,eAAe,YAAYA,oBAAI,eAAe,OAAO;AAAA,cACrD,gBAAgB;AAAA,YAClB;AAAA,YACA,MAAM;AAAA,YACN,SAAS,CAACC,aAAY;AACpB,sBAAQ,IAAIA,QAAO;AACnB,oBAAM,UAAU,KAAK,MAAMA,SAAQ,IAAI;AACvC,sBAAQ,IAAI,OAAO;AACnB,0BAAY,QAAQ,GAAG;AAAA,YACzB;AAAA,UAAA,CACD;AAAA,QACH;AAAA,QACA,MAAM,CAAC,QAAQ;AACb,kBAAQ,IAAI,GAAG;AACfD,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACP;AAAA,QACH;AAAA,QACA,UAAU,CAAC,aAAa;AACtB,kBAAQ,IAAI,QAAQ;AAAA,QACtB;AAAA,MAAA,CACD;AAAA,IAAA;AAEH,UAAM,YAAY,MAAM;;AACtB,kBAAM,UAAN,mBAAa;AACbA,oBAAAA,MAAI,aAAa;AAAA,QACf,KAAI,OAAO;AAAA,QACX,SAAQ,CAAC,QAAM;AACV,cAAA,IAAI,eAAa,KAAI;AACtBA,0BAAAA,MAAI,uBAAuB;AAAA,cACzB,UAAU,IAAI;AAAA,cACd,SAAS,CAAC,YAAY;AACpB,wBAAQ,IAAI,OAAO;AAAA,cACrB;AAAA,cACA,MAAM,CAAC,QAAQ;AACb,wBAAQ,IAAI,GAAG;AAAA,cACjB;AAAA,cACA,UAAU,CAAC,aAAa;AACtB,wBAAQ,IAAI,QAAQ;AAAA,cACtB;AAAA,YAAA,CACD;AAAA,UAAA,OACE;AACHA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAM;AAAA,cACN,MAAK;AAAA,YAAA,CACN;AAAA,UACH;AAAA,QACF;AAAA,QACA,MAAK,CAAC,SAAO;AACH,kBAAA,IAAI,QAAO,IAAI;AAAA,QACzB;AAAA,MAAA,CACH;AAAA,IAAA;AAGD,UAAM,SAAS,MAAM;;AACnB,cAAQ,IAAI,IAAI;AAChB,kBAAM,UAAN,mBAAa;AAAA,IAAM;;;;;;;;;;;;;;;;AC5IrB,GAAG,WAAW,eAAe;"}