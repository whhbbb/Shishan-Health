{"version":3,"file":"recommend.js","sources":["../../../../../src/pages/recommend/recommend.vue","../../../../../uniPage:/cGFnZXMvcmVjb21tZW5kL3JlY29tbWVuZC52dWU"],"sourcesContent":["<template v-if=\"isPastTargetDate\">\n  <view v-if=\"isPastTargetDate\">\n    <view class=\"page\" :style=\"{ paddingBottom: safeAreaInsets?.bottom! + 100 + 'rpx' }\">\n      <!-- 列表 -->\n      <view class=\"CircleList\" v-for=\"(item0, index0) in DataSource\" :key=\"index0\">\n        <!-- 头像、昵称、内容 -->\n        <view class=\"body-view\">\n          <!-- 头像 -->\n          <!-- <view class=\"left-view\">\n            <image class=\"user-icon\" :src=\"item0.avatar\"></image>\n          </view> -->\n          <view @tap=\"gotoRD(item0.id)\" class=\"center-view\">\n            <!-- 昵称 -->\n            <view class=\"user-name-view\">\n              <view class=\"left-view\">\n                <view class=\"left-view-icon\">\n                  <image class=\"user-icon\" :src=\"item0.avatar\"></image>\n                </view>\n                <view class=\"left-view-contents\">\n                  <label class=\"user-name\">{{ item0.nickName }}</label>\n                  <label class=\"time\">{{ item0.createTime }}</label>\n                </view>\n              </view>\n              <view class=\"recommend\" v-if=\"item0.status == 3\">\n                <image class=\"recommend-icon\" src=\"../../static/recommend/active-recommend.png\" mode=\"heightFix\" />\n              </view>\n            </view>\n            <!-- 内容 -->\n            <view class=\"user-content-view\">\n              <!-- <view class=\"theme-view\">\n                <text class=\"user-content\">主题:{{ item0.theme }}</text>\n                <text class=\"user-content\">主讲人:{{ item0.lecturerName }}</text>\n              </view> -->\n              <text class=\"user-content\">{{ item0.content }}</text>\n            </view>\n            <!-- 推荐的活动 -->\n            <view @tap.stop=\"navToAct(item0.tblActivity?.id)\" class=\"activity\">\n              <view class=\"img-wrapper\">\n                <image\n                  class=\"activity-img\"\n                  :src=\"item0.tblActivity?.lng\"\n                  mode=\"scaleToFill\"\n                />\n              </view>\n              <view class=\"activity-content\">\n                <view class=\"title\">{{ item0.tblActivity?.userImg2 }}</view>\n                <view class=\"speaker\">主讲人： {{ item0.tblActivity?.speakerName }}</view>\n              </view>\n            </view>\n            <!-- 工具栏 -->\n            <view class=\"tool-box\">\n              <view class=\"like-up\">\n                <image\n                  v-if=\"item0.tblLike == null\"\n                  class=\"like\"\n                  src=\"../../static/column/heart.png\"\n                  mode=\"scaleToFill\"\n                  @tap.stop=\"iLike(item0.id, item0.tblLike)\"\n                />\n                <image\n                  v-else\n                  class=\"like\"\n                  src=\"../../static/column/heart-active.png\"\n                  mode=\"scaleToFill\"\n                  @tap.stop=\"iLike(item0.id, item0.tblLike)\"\n                />\n                <text>{{ item0.likeCount }}</text>\n              </view>\n              <view class=\"comment\">\n                <image\n                  class=\"comment-img\"\n                  src=\"../../static/recommend/comment.png\"\n                  mode=\"scaleToFill\"\n                />\n                <!-- <text>{{ item0.tblRecommendCommnets.length }}</text> -->\n              </view>\n            </view>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n\n  <view v-if=\"isPastTargetDate\" class=\"rbutton-view\">\n    <button class=\"rbutton\" @click=\"rclick\">\n      <uni-icons type=\"plusempty\" class=\"plusIcon\" size=\"20\"></uni-icons>\n    </button>\n  </view>\n  <!-- </view> -->\n</template>\n\n<script setup lang=\"ts\">\nimport { onLaunch, onLoad, onPullDownRefresh, onShow, onReachBottom } from '@dcloudio/uni-app'\nimport { ref, reactive, computed } from 'vue'\nimport {\n  getRecommedList,\n  sendLike,\n  deletLike,\n  sendcommen,\n  getRecommedDetail,\n} from '@/services/recommed'\nimport debounce from '@/utils/tool'\n//过审\n// 获取当前时间点\nconst currentTime = ref(new Date())\n\n// 计算2023年11月17号的时间点\nconst targetDate = new Date('2023-11-23')\n\n// 判断当前时间是否已经过了2023年11月18号\nimport { getAudit } from '@/services/Audit'\nconst isPastTargetDate = ref<boolean>(true)\nconst getA = async () => {\n  pageNum = 1\n  const res = await getAudit()\n  isPastTargetDate.value = res.data\n  if (isPastTargetDate.value) {\n    getRecommed()\n  }\n}\n\nconst navToAct = (id) => {\n  uni.navigateTo({\n    url:`/pages/activity/ActivityDetails?id=${id}`\n  })\n}\n\nonReachBottom(() => {\n  getRecommed()\n})\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\nlet pageNum = 1\nconst total = ref()\n//获取页面初始数据\nconst DataSource = ref([])\nconst getRecommed = debounce(async () => {\n  uni.showLoading({\n    title: '加载中',\n  })\n  if (pageNum == 1) {\n    const res = await getRecommedList({\n      pageNum: pageNum,\n      pageSize: 10,\n    })\n    total.value = res.total\n    DataSource.value = res.rows\n    pageNum = pageNum + 1\n  } else {\n    if (DataSource.value.length >= total.value) {\n      uni.showToast({\n        title: '已经到底啦',\n        icon: 'none',\n        durationL: 800,\n      })\n      return\n    }\n    const res = await getRecommedList({\n      pageNum: pageNum,\n      pageSize: 10,\n    })\n    total.value = res.total\n    DataSource.value = [...DataSource.value, ...res.rows]\n    pageNum = pageNum + 1\n  }\n  uni.hideLoading()\n})\n\n//去详情页\nconst rclick = () => {\n  uni.navigateTo({\n    url: '/pages/recommend/makeRecd',\n  })\n}\n//点赞\nconst exchangeObject = async (objId) => {\n  let index = DataSource.value.findIndex((obj) => obj.id === objId)\n  const res = await getRecommedDetail(objId)\n  if (index !== -1) {\n    DataSource.value.splice(index, 1, res.data)\n  }\n}\nconst sendLikeTo = async (id) => {\n  const res = await sendLike(id)\n  if (res.code == 200) {\n    exchangeObject(id)\n  }\n}\nconst delLike = async (id) => {\n  const res = await deletLike(id)\n  if (res.code == 200) {\n    exchangeObject(id)\n  }\n}\nconst iLike = (id, tblLike) => {\n  if (uni.getStorageSync('token')) {\n    if (tblLike) {\n      delLike(id)\n    } else {\n      sendLikeTo(id)\n    }\n  } else {\n    wx.showToast({\n      title: '您尚未登录，请先登录',\n      icon: 'none',\n      duration: 1000,\n      complete: () => {\n        setTimeout(() => {\n          uni.navigateTo({\n            url: '/pages/login/login',\n          })\n        }, 1000)\n      },\n    })\n  }\n}\n\n//评论\nconst showInput = ref(false)\nconst comment = ref('')\nconst currentItemId = ref<number>()\n// 自动弹出键盘\nconst isInputFocused = ref(true)\nconst showInputBox = (itemId) => {\n  if (uni.getStorageSync('token')) {\n    showInput.value = true\n    currentItemId.value = itemId\n  } else {\n    uni.showToast({\n      title: '您尚未登录，请先登录',\n      icon: 'none',\n      duration: 1000,\n      complete: () => {\n        setTimeout(() => {\n          uni.navigateTo({\n            url: '/pages/login/login',\n          })\n        }, 1000)\n      },\n    })\n  }\n}\n// 去recommend详情\nconst goRDid = ref()\nconst goRD = async (id) => {\n  const res = await getRecommedDetail(id)\n  uni.setStorageSync('goRD_id', id)\n  uni.navigateTo({\n    url: '/pages/recommend/recommendDetail?id=' + id,\n  })\n}\nconst gotoRD = (id) => {\n  goRD(id)\n}\nonLoad(() => {\n  getA()\n})\nonShow(() => {\n  getA()\n})\n</script>\n<style scoped lang=\"scss\">\n/* pages/posts/post-detail/post-detail.wxss */\npage{\n  width: 100%;\n}\n\n.page {\n  width: 100%;\n  padding-bottom: 100rpx;\n  /* overflow-x: hidden */\n}\n\n/* 列表 */\n.CircleList {\n  background: white;\n  width: 81%;\n  margin: 0 auto;\n  margin-bottom: 1px;\n  border-bottom: 1px solid rgb(237, 235, 235);\n  padding-bottom: 40rpx;\n  padding-top: 30rpx;\n}\n\n.body-view {\n  display: flex;\n}\n\n.center-view {\n  width: 100%;\n  .user-name-view {\n    display: flex;\n    margin-bottom: 20rpx;\n    .left-view {\n      display: flex;\n      .left-view-icon{\n\n        /* 头像 */\n        .user-icon {\n          width: 100rpx;\n          height: 100rpx;\n          border-radius: 50%;\n          margin-right: 20rpx;\n        }\n      }\n\n      .left-view-contents{\n        /* 昵称 */\n        .user-name {\n          display: flex;\n          font-size: 32rpx;\n          color: rgb(88, 103, 138);\n        }\n\n        .time{\n          font-size: 25rpx;\n        }\n      }\n    }\n    .recommend{\n      flex: 1;\n      display: flex;\n      justify-content: flex-end;\n      align-items: center;\n      .recommend-icon{\n        height: 45rpx;\n      }\n    }\n  }\n\n}\n\n.theme-view {\n  margin: 2vh 0;\n  color: #999;\n  /* font-weight: 600; */\n}\n\n/* 内容 */\n.theme,\n.lecturename,\n.user-content {\n  display: flex;\n  text-indent: 55rpx;\n  font-size: 30rpx;\n  line-height: 50rpx;\n  word-break: break-all;\n  overflow: hidden;\n  /* font-family: 'Verdana', sans-serif; */\n}\n\n.theme {\n  font-family: 'Times New Roman', serif;\n  font-size: small;\n}\n\n.lecturename {\n  font-family: 'Times New Roman', serif;\n\n  font-size: x-small;\n}\n\n/* 图片 */\n.photo-view {\n  background: rebeccapurple;\n  margin-left: 10rpx;\n  margin-bottom: 20rpx;\n}\n\n.photo {\n  background: rgb(255, 166, 0);\n  float: left;\n  margin-right: 10rpx;\n  margin-top: 10rpx;\n}\n\n/* .zan-view{\n    width:100%;\n    background-color: aqua;\n  } */\n.trigon-view {\n  display: flex;\n  flex-direction: row;\n  padding: 3rpx 10rpx;\n  width: 100%;\n  justify-content: space-between;\n  border-radius: 10rpx;\n  background-color: rgb(241, 241, 241);\n}\n\n/* .line {\n  width: 97%;\n  height: 1px;\n  background: white;\n} */\n\n.activity{\n  margin-top: 15rpx;\n  display: flex;\n  // align-items: center;\n  padding: 20rpx;\n  background-color: rgb(245, 245, 245);\n  border-radius: 20rpx;\n  .img-wrapper{\n    margin:auto 0;\n    width: 20%;\n    height: 160rpx;\n    background-color: rgb(88, 103, 138);\n    border-radius: 8rpx;\n    margin-right: 12rpx;\n  }\n  .activity-content{\n    flex: 1;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    .title{\n      font-size: 30rpx;\n      color: #000;\n      font-weight: bold;\n      margin: 5rpx 0 10rpx 0;\n    }\n    .speaker{\n      font-size: 25rpx;\n      color: #000;\n    }\n  }\n}\n\n/* 工具栏 */\n.tool-box{\n  display: flex;\n  align-items: center;\n  margin-top: 18rpx;\n  .like-up{\n    margin-right: 20rpx;\n    .like{\n      width: 40rpx;\n      height: 40rpx;\n      margin-right: 10rpx;\n    }\n  }\n  .comment{\n    .comment-img{\n      width: 40rpx;\n      height: 40rpx;\n      margin-right: 10rpx;\n    }\n  }\n}\n\n.rbutton-view {\n  background-color: rgba(0, 0, 0, 0);\n  position: fixed;\n  bottom: 3%;\n  right: 0%;\n  transform: translateX(-50%);\n}\n\n.rbutton {\n  border-radius: 50%;\n  height: 100rpx;\n  width: 100rpx;\n  line-height: 100rpx;\n  background-color: rgb(235, 235, 235);\n  margin: 2rpx;\n  position: relative;\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);\n}\n\n.plusIcon {\n  position: absolute;\n  left: 50%;\n  transform: translateX(-50%);\n}\n</style>\n","import MiniProgramPage from '/Users/whhbbb/Documents/Project-storage/xswc_game/src/pages/recommend/recommend.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getAudit","uni","onReachBottom","debounce","getRecommedList","getRecommedDetail","sendLike","deletLike","wx","onLoad","onShow"],"mappings":"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"}