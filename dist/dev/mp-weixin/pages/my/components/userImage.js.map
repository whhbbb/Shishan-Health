{"version":3,"file":"userImage.js","sources":["../../../../../../src/pages/my/components/userImage.vue","../../../../../../uniPage:/cGFnZXMvbXkvY29tcG9uZW50cy91c2VySW1hZ2UudnVl"],"sourcesContent":["<template>\n  <view class=\"userImage\">\n    <view class=\"img\" @tap=\"doImg\">\n      <image :src=\"avatar\" />\n    </view>\n  </view>\n  <uni-popup ref=\"popup\">\n    <view class=\"pop\">\n      <view class=\"btns\">\n        <!-- <button @click=\"takePhoto\">拍照</button> -->\n        <button @click=\"chooseImage\">从相册选择</button>\n        <button @click=\"saveImage\">保存图片</button>\n      </view>\n      <button class=\"btn\" @tap=\"cancel\">取消</button>\n    </view>\n  </uni-popup>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, reactive } from 'vue'\nimport { changePersonalInf } from '@/services/personalInf'\nconst popup = ref<{\n  open: (type?: UniHelper.UniPopupType) => void\n  close: () => void\n}>()\nconst props = defineProps<{\n  userAvatar: string\n}>()\n\nconst avatar = ref<string>(props.userAvatar)\n\nconst editUserImg = async (imgUrl: string) => {\n  const res = await changePersonalInf({\n    // userName: props.userName,\n    avatar: imgUrl,\n  })\n  console.log(res)\n  if (res.code === 200) {\n    uni.showToast({\n      title: '修改成功',\n      icon: 'none',\n    })\n    avatar.value = imgUrl\n  } else {\n    uni.showToast({\n      title: '修改失败',\n      icon: 'none',\n    })\n  }\n}\nconst doImg = () => {\n  console.log('点击了图片')\n  if (popup.value) {\n    popup.value.open('bottom')\n  }\n}\n// const takePhoto = () => {\n//   console.log('拍照')\n//   popup.value?.close()\n//   uni.chooseImage({\n//     count: 1,\n//     sourceType: ['camera'],\n//     success: (success) => {\n//       console.log(success)\n//     },\n//     fail: (err) => {\n//       console.log(err)\n//     },\n//     complete: (complete) => {\n//       console.log(complete)\n//     },\n//   })\n// }\nconst chooseImage = () => {\n  console.log('从相册选择')\n  popup.value?.close()\n  uni.chooseImage({\n    count: 1,\n    sourceType: ['album'],\n    success: (success) => {\n      uni.uploadFile({\n        url: 'https://www.academictime.cn:3166/system/common/upload',\n        filePath: success.tempFilePaths[0],\n        header: {\n          Authorization: 'Bearer ' + uni.getStorageSync('token'),\n          'Content-Type': 'multipart/form-data',\n        },\n        name: 'file',\n        success: (success) => {\n          console.log(success)\n          const resData = JSON.parse(success.data)\n          console.log(resData)\n          editUserImg(resData.msg)\n        },\n      })\n    },\n    fail: (err) => {\n      console.log(err)\n      uni.showToast({\n        title: '上传失败',\n        icon: 'none',\n      })\n    },\n    complete: (complete) => {\n      console.log(complete)\n    },\n  })\n}\nconst saveImage = () => {\n  popup.value?.close()\n  uni.downloadFile({\n    url:avatar.value,\n    success:(res)=>{\n      if(res.statusCode===200){\n        uni.saveImageToPhotosAlbum({\n          filePath: res.tempFilePath,\n          success: (success) => {\n            console.log(success)\n          },\n          fail: (err) => {\n            console.log(err)\n          },\n          complete: (complete) => {\n            console.log(complete)\n          },\n        })\n      }else{\n        uni.showToast({\n          title:'保存失败',\n          icon:'none'\n        })\n      }\n    },\n    fail:(fail)=>{\n      console.log('下载失败',fail);\n    },\n})\n}\n\nconst cancel = () => {\n  console.log('取消')\n  popup.value?.close()\n}\n</script>\n<style lang=\"scss\">\n.userImage {\n  background-color: #000;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  .img {\n    height: 700rpx;\n    width: 700rpx;\n  }\n}\n\n.pop {\n  display: flex;\n  flex-direction: column;\n  background-color: white;\n  border-radius: 20rpx;\n\n  .btns {\n    height: 250rpx;\n    width: 100%;\n    text-align: center;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-around;\n\n    button {\n      flex: 1;\n      width: 100%;\n      box-sizing: border-box;\n      border-bottom: 1px solid #e5e3e3;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n  }\n\n  .btn {\n    width: 100%;\n    border-top: 5px solid #e5e3e3;\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/whhbbb/Documents/Project-storage/xswc_game/src/pages/my/components/userImage.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","changePersonalInf","uni","success"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA,UAAM,QAAQA,cAAAA;AAQR,UAAA,SAASA,cAAAA,IAAY,MAAM,UAAU;AAErC,UAAA,cAAc,OAAO,WAAmB;AACtC,YAAA,MAAM,MAAMC,uCAAkB;AAAA;AAAA,QAElC,QAAQ;AAAA,MAAA,CACT;AACD,cAAQ,IAAI,GAAG;AACX,UAAA,IAAI,SAAS,KAAK;AACpBC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACD,eAAO,QAAQ;AAAA,MAAA,OACV;AACLA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AAAA,MACH;AAAA,IAAA;AAEF,UAAM,QAAQ,MAAM;AAClB,cAAQ,IAAI,OAAO;AACnB,UAAI,MAAM,OAAO;AACT,cAAA,MAAM,KAAK,QAAQ;AAAA,MAC3B;AAAA,IAAA;AAmBF,UAAM,cAAc,MAAM;;AACxB,cAAQ,IAAI,OAAO;AACnB,kBAAM,UAAN,mBAAa;AACbA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,YAAY,CAAC,OAAO;AAAA,QACpB,SAAS,CAAC,YAAY;AACpBA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK;AAAA,YACL,UAAU,QAAQ,cAAc,CAAC;AAAA,YACjC,QAAQ;AAAA,cACN,eAAe,YAAYA,oBAAI,eAAe,OAAO;AAAA,cACrD,gBAAgB;AAAA,YAClB;AAAA,YACA,MAAM;AAAA,YACN,SAAS,CAACC,aAAY;AACpB,sBAAQ,IAAIA,QAAO;AACnB,oBAAM,UAAU,KAAK,MAAMA,SAAQ,IAAI;AACvC,sBAAQ,IAAI,OAAO;AACnB,0BAAY,QAAQ,GAAG;AAAA,YACzB;AAAA,UAAA,CACD;AAAA,QACH;AAAA,QACA,MAAM,CAAC,QAAQ;AACb,kBAAQ,IAAI,GAAG;AACfD,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACP;AAAA,QACH;AAAA,QACA,UAAU,CAAC,aAAa;AACtB,kBAAQ,IAAI,QAAQ;AAAA,QACtB;AAAA,MAAA,CACD;AAAA,IAAA;AAEH,UAAM,YAAY,MAAM;;AACtB,kBAAM,UAAN,mBAAa;AACbA,oBAAAA,MAAI,aAAa;AAAA,QACf,KAAI,OAAO;AAAA,QACX,SAAQ,CAAC,QAAM;AACV,cAAA,IAAI,eAAa,KAAI;AACtBA,0BAAAA,MAAI,uBAAuB;AAAA,cACzB,UAAU,IAAI;AAAA,cACd,SAAS,CAAC,YAAY;AACpB,wBAAQ,IAAI,OAAO;AAAA,cACrB;AAAA,cACA,MAAM,CAAC,QAAQ;AACb,wBAAQ,IAAI,GAAG;AAAA,cACjB;AAAA,cACA,UAAU,CAAC,aAAa;AACtB,wBAAQ,IAAI,QAAQ;AAAA,cACtB;AAAA,YAAA,CACD;AAAA,UAAA,OACE;AACHA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAM;AAAA,cACN,MAAK;AAAA,YAAA,CACN;AAAA,UACH;AAAA,QACF;AAAA,QACA,MAAK,CAAC,SAAO;AACH,kBAAA,IAAI,QAAO,IAAI;AAAA,QACzB;AAAA,MAAA,CACH;AAAA,IAAA;AAGD,UAAM,SAAS,MAAM;;AACnB,cAAQ,IAAI,IAAI;AAChB,kBAAM,UAAN,mBAAa;AAAA,IAAM;;;;;;;;;;;;;;;;AC5IrB,GAAG,WAAW,eAAe;"}