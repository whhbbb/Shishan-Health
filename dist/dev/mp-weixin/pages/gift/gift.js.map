{"version":3,"file":"gift.js","sources":["../../../../../src/pages/gift/gift.vue","../../../../../uniPage:/cGFnZXMvZ2lmdC9naWZ0LnZ1ZQ"],"sourcesContent":["<template>\n  <div class=\"main\" :style=\"{ paddingBottom: safeAreaInsets?.bottom!+ 0 + 'px' }\">\n    <view class=\"swiper-wrapper\">\n      <swiper\n        class=\"swiper\"\n        :indicator-dots=\"indicatorDots\"\n        :autoplay=\"autoplay\"\n        :interval=\"interval\"\n        :duration=\"duration\"\n      >\n        <swiper-item v-for=\"(url, index) in goodsdata.imgs\" :key=\"index\" @click=\"previewImage\">\n          <image :src=\"url\" mode=\"aspectFill\" class=\"image_detail\" />\n        </swiper-item>\n      </swiper>\n    </view>\n\n    <scroll-view class=\"scroll-view\" :scroll-y=\"true\">\n      <view class=\"detail\">\n        <!-- <text class=\"price\">{{ goodsdata.price }}积分</text> -->\n        <view class=\"title-view\">\n          <view class=\"title\">{{ goodsdata.name }}</view>\n          <view class=\"right-part\">\n            <view class=\"need-score\">\n              <image\n                class=\"score-img\"\n                src=\"../../static/gifts/score.png\"\n                mode=\"scaleToFill\"\n              />\n              <text>{{ goodsdata.price }}积分</text>\n            </view>\n          </view>\n        </view>\n        <uni-tag\n          class=\"tag\"\n          :text=\"`总库存：${goodsdata.allnums}`\"\n          size=\"mini\"\n          :inverted=\"true\"\n          type=\"success\"\n        />\n        <text class=\"text-remark\">{{ goodsdata.introduce }}</text>\n      </view>\n      <view class=\"temp\"></view>\n    </scroll-view>\n\n    <view class=\"detail-nav\" :style=\"{ bottom: safeAreaInsets?.bottom!+ 0 + 'px' }\">\n      <view class=\"num-box\">\n        <uni-number-box\n          class=\"numchooseBox\"\n          @blur=\"blur\"\n          :max=\"maxNum\"\n          v-model=\"goodsnum\"\n        ></uni-number-box>\n      </view>\n      <view class=\"score-box\" @tap=\"immeBuy\">\n        <image\n          class=\"score-img\"\n          src=\"../../static/gifts/blue-score.png\"\n        />\n        <view class=\"scorenum\">{{ scoreres }}</view>\n        <view class=\"text\">立即兑换</view>\n      </view>\n      <!-- <button :disabled=\"goodsnum == 0\" class=\"button-red\" @click=\"immeBuy\" formType=\"submit\">\n        立即兑换\n      </button> -->\n    </view>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n// import { ref, reactive } from 'vue'\n// import { onLoad } from '@dcloudio/uni-app';\n\n// onLoad(() => {\n//   uni.showToast({\n//     title: '礼品中心部分功能尚未实现，敬请期待~',\n//     icon: 'none',\n//     duration: 2000,\n//     complete: function () {\n//       setTimeout(function () {\n//         uni.switchTab({\n//           url: '/pages/index/index'\n//         });\n//       }, 2000); // 在弹窗关闭后，延迟2秒执行页面跳转\n//     }\n//   })\n// })\n\nimport { onLoad, onShow } from '@dcloudio/uni-app'\nimport { ref, computed, watch } from 'vue'\nimport { getGiftDetail, exchangeGift } from '@/services/gift'\nimport { getPersonalInf } from '@/services/personalInf'\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n\nconst props = defineProps<{\n  id: number\n}>()\n\nconst goodsnum = ref<number>(0)\nconst goodsdata = ref<any>({})\n\nconst getGiftDetails = async (id) => {\n  const res = await getGiftDetail(id)\n  console.log(res.data)\n  goodsdata.value = res.data\n}\nconst getMyCredit = async () => {\n  const res = await getPersonalInf()\n  console.log(res.data.credit)\n  mycredit.value = res.data.credit\n}\nconst mycredit = ref<number>(1)\nconst blur = (e) => {\n  console.log(e)\n  // 判断所需金额是否超出所拥有的金额\n  if (e.detail.value > goodsdata.value.allnums) {\n    uni.showToast({\n      title: '兑换数量超出库存',\n      icon: 'none',\n      duration: 1000,\n    })\n    return\n  }\n}\nconst maxNum = computed(() => {\n  return goodsdata.value.allnums\n})\nconst scoreres = computed(() => {\n  return (goodsnum.value * goodsdata.value.price).toFixed(2)\n})\n// watch([goodsnum.value, () => goodsdata.value.price], ([newgoodsnum]) => {\n//   scoreres.value = newgoodsnum * goodsdata.value.price;\n// });\nonShow(() => {\n  if (uni.getStorageSync('token')) {\n    getMyCredit()\n  }\n})\nonLoad(() => {\n  if (uni.getStorageSync('token')) {\n    console.log(props.id)\n    getGiftDetails(props.id)\n    getMyCredit()\n  } else {\n    wx.showToast({\n      title: '您尚未登录，请先登录',\n      icon: 'none',\n      duration: 1000,\n      complete: () => {\n        setTimeout(() => {\n          uni.navigateTo({\n            url: '/pages/login/login',\n          })\n        }, 1000)\n      },\n    })\n  }\n})\n\nconst indicatorDots = true\nconst autoplay = true\nconst interval = 3000\nconst duration = 1000\n\nconst previewImage = (e) => {\n  var current = e.target.dataset.src\n  console.log(current)\n  wx.previewImage({\n    current: current,\n    urls: goodsdata.value.imgs,\n  })\n}\n\nconst applyExchange = async (data) => {\n  const res = await exchangeGift(data)\n  console.log(res)\n  if (res.code == 200) {\n    if (res.data == 3) {\n      uni.showToast({\n        title: '兑换成功！',\n        icon: 'success',\n        duration: 2000,\n        complete: function () {\n          setTimeout(function () {\n            getGiftDetails(props.id)\n            getMyCredit()\n            goodsnum.value = 0\n            // uni.navigateTo({\n            //   url: '/pages/gift/giftCenter',\n            // })\n          }, 2000) // 在弹窗关闭后，延迟2秒执行页面跳转\n        },\n      })\n    }\n    if (res.data == 2) {\n      uni.showToast({\n        title: '余额不足！',\n        icon: 'error',\n        duration: 2000,\n        success: () => {\n          goodsnum.value = 0\n        },\n      })\n    }\n    if (res.data == 1) {\n      uni.showToast({\n        title: '库存不足！',\n        icon: 'error',\n        duration: 2000,\n      })\n    }\n  }\n}\nconst immeBuy = () => {\n  console.log('购买')\n  if (mycredit.value < goodsnum.value * goodsdata.value.price) {\n    uni.showToast({\n      title: '剩余积分不足',\n      icon: 'error',\n      duration: 2000,\n    })\n    return\n  }\n  wx.showModal({\n    title: '确认兑换',\n    content: '确定要兑换吗？',\n    success(res) {\n      if (res.confirm) {\n        //用户点击了确认按钮\n        applyExchange({\n          id: null,\n          goodsId: goodsdata.value.id,\n          nums: goodsnum.value,\n        })\n      } else if (res.cancel) {\n        // 用户点击了取消按钮\n        console.log('用户取消了兑换')\n      }\n    },\n  })\n}\n</script>\n<style scoped lang=\"scss\">\npage {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n.main{\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  align-items: center;\n}\n/* 直接设置swiper属性 */\n.swiper-wrapper{\n  margin-top: 20rpx;\n  height: 800rpx;\n  width: 100%;\n  .swiper{\n    width: 82%;\n    height: 100%;\n    margin: 0 auto;\n    border-radius: 20rpx;\n  }\n}\nswiper-item image {\n  width: 100%;\n  height: 100%;\n}\n.separate {\n  height: 20rpx;\n  background-color: whitesmoke;\n  margin-top: 10rpx;\n  width: 100%;\n}\n.scroll-view {\n  height: 100%;\n  width: 82%;\n  margin: 0 auto;\n  background-color: #fff;\n}\n.goodsimg {\n  height: 600rpx;\n  width: 100%;\n  display: flex;\n  justify-content: space-around;\n}\n.detail {\n  display: flex;\n  flex-direction: column;\n  margin: 15rpx 10rpx 0;\n}\n.detail .title {\n  font-size: 40rpx;\n  color: black;\n  text-align: justify;\n}\n.detail .price {\n  color: red;\n  font-size: 40rpx;\n  margin: 10rpx;\n  margin-top: 30rpx;\n}\n.title-view {\n  margin: 10rpx 0;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  .right-part {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    .need-score {\n      display: flex;\n      align-items: center;\n      font-size: 25rpx;\n      .score-img {\n        width: 30rpx;\n        height: 30rpx;\n        margin-right: 5rpx;\n      }\n    }\n  }\n}\n.tag {\n  margin-bottom: 10rpx;\n}\n.line_flag {\n  width: 80rpx;\n  height: 1rpx;\n  display: inline-block;\n  margin: 20rpx auto;\n  background-color: gainsboro;\n  text-align: center;\n}\n.line {\n  width: 100%;\n  height: 2rpx;\n  display: inline-block;\n  margin: 20rpx 0rpx;\n  background-color: gainsboro;\n  text-align: center;\n}\n.detail-nav {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  background-color: #fff;\n  position: fixed;\n  bottom: 0;\n  z-index: 100;\n  width: 82%;\n  margin: 0 auto;\n  height: 100rpx;\n  border-top: 1rpx solid #f0f0f0;\n  .num-box{\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-right: 20rpx;\n  }\n  .score-box{\n    background-color: #D4EDF5;\n    height: 80%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    border-radius: 10rpx;\n    margin-left: 20rpx;\n    .score-img{\n      width: 30rpx;\n      height: 30rpx;\n    }\n    .scorenum{\n      color: #0077B6;\n      font-size: 30rpx;\n      font-weight: bold;\n      margin-left: -20rpx;\n    }\n    .text{\n      font-size: 30rpx;\n      font-weight: bold;\n      margin: 10rpx;\n      color: #0077B6;\n    }\n  }\n}\n.goodsdimg {\n  margin-bottom: 7px;\n}\n.image_detail {\n  width: 100%;\n}\n.detail-nav image {\n  width: 70rpx;\n  height: 50rpx;\n  margin: 20rpx 40rpx;\n}\n.line_nav {\n  width: 100%;\n  background-color: #fff;\n  position: fixed;\n  bottom: 0;\n}\n/* 占位 */\n.temp {\n  height: 100rpx;\n}\ntext {\n  display: block;\n  /* height: 50rpx; */\n  line-height: 50rpx;\n  /* font-size: 30rpx; */\n  margin: 10rpx;\n}\n.text-remark {\n  display: block;\n  font-size: 27rpx;\n}\n.num-box {\n  font-size: 27rpx;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n}\n.score-box {\n  width: 82%;\n  margin: 0 auto;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n.scorenum {\n  color: #f44336;\n  display: block;\n  font-size: 30rpx;\n  margin: 10rpx;\n}\n.numchooseBox {\n  margin: auto 0;\n}\n</style>\n","import MiniProgramPage from '/Users/whhbbb/Documents/Project-storage/xswc_game/src/pages/gift/gift.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getGiftDetail","getPersonalInf","computed","onShow","onLoad","wx","exchangeGift"],"mappings":"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"}